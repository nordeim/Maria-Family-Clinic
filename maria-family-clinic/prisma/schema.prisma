// This is your Prisma schema file
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  // Enable PostGIS types
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Enable PostGIS extension
model geospatial_extensions {
  // PostGIS extension enablement
  id String @id @default(cuid()) @map("_id")
}

// User Management Models
model User {
  id             String   @id @default(cuid())
  email          String   @unique
  name           String?
  image          String?
  emailVerified  DateTime?
  role           UserRole @default(PATIENT)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relationships
  accounts       Account[]
  sessions       Session[]
  profile        UserProfile?
  preferences    UserPreferences?
  enquiries      Enquiry[]
  searchLogs     SearchLog[]
  auditLogs      AuditLog[]
  reviews        ClinicReview[]
  
  // Package relationships
  packageBookings PackageBooking[]
  packageReviews  PackageReview[]
  
  // Referral relationships
  referrals       ServiceReferral[] // Patient referrals

  // Healthier SG Eligibility relationships
  eligibilityAssessments EligibilityAssessment[]
  eligibilityAppeals     EligibilityAppeal[]
  
  // Government Compliance relationships
  consentRecords   ConsentRecord[]
  securityEvents   SecurityEvent[] // Events where user is affected

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model UserProfile {
  id               String   @id @default(cuid())
  userId           String   @unique
  phone            String?
  address          String?
  postalCode       String?
  dateOfBirth      DateTime?
  gender           Gender?
  nric             String?  // Singapore NRIC (encrypted)
  preferredLanguage String  @default("en")
  emergencyContact String?
  medicalConditions String[] // Array of medical conditions
  allergies        String[] // Array of allergies
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

model UserPreferences {
  id                    String   @id @default(cuid())
  userId                String   @unique
  emailNotifications    Boolean  @default(true)
  smsNotifications      Boolean  @default(false)
  newsletterSubscription Boolean @default(false)
  theme                 String   @default("light")
  language              String   @default("en")
  accessibilitySettings Json     @default("{}") // WCAG preferences
  searchHistory         Json     @default("[]") // Recent searches
  favorites             String[] @default([])   // Favorite clinic IDs
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

// Clinic Management Models
model Clinic {
  id                 String   @id @default(cuid())
  name               String
  description        String?
  address            String
  postalCode         String
  phone              String?
  email              String?
  website            String?
  
  // Geospatial data (PostGIS Point)
  latitude           Float
  longitude          Float
  location           Unsupported("geography(Point, 4326)") // PostGIS geography type
  
  operatingHours     Json     @default("{}") // JSON object with operating hours
  facilities         String[] @default([])  // Array of facility names
  accreditationStatus String  @default("pending")
  
  // Contact information
  emergencyPhone     String?
  afterHoursPhone    String?
  
  // Business information
  establishedYear    Int?
  licenseNumber      String?
  licenseExpiry      DateTime?
  
  // Status and metadata
  isActive           Boolean  @default(true)
  isVerified         Boolean  @default(false)
  rating             Float?   @default(0)
  reviewCount        Int      @default(0)
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Relationships
  services           ClinicService[]
  languages          ClinicLanguage[]
  doctors            DoctorClinic[]
  enquiries          Enquiry[]
  operatingHoursDays OperatingHours[]
  reviews            ClinicReview[]
  availabilities     ServiceAvailability[]
  doctorAvailabilities DoctorAvailability[] // Added reverse relation
  
  // Service expertise relationships
  serviceExpertise   ServiceExpertise[]
  
  // Referral relationships
  referringClinics   ServiceReferral[] @relation("ReferringClinic")
  referredClinics    ServiceReferral[] @relation("ReferredClinic")

  @@index([latitude, longitude])
  @@index([isActive])
  @@map("clinics")
}

model ClinicService {
  id                 String   @id @default(cuid())
  clinicId           String
  serviceId          String
  
  // Service availability at this clinic
  isAvailable        Boolean  @default(true)
  estimatedDuration  Int?     // Duration in minutes
  price              Float?   // Specific price at this clinic
  currency           String   @default("SGD")
  
  // Enhanced pricing structure
  basePrice          Float?   // Base price before any discounts
  finalPrice         Float?   // Final price after all adjustments
  
  // Insurance and subsidy coverage
  isHealthierSGCovered Boolean @default(false)
  healthierSGPrice   Float?   // Healthier SG subsidized price
  
  // Medisave and Medishield integration
  medisaveCovered    Boolean  @default(false)
  medisaveAmount     Float?   // Medisave coverage amount
  medishieldCovered  Boolean  @default(false)
  medishieldDeductible Float? // Medishield deductible
  
  // CHAS integration
  chasCovered        Boolean  @default(false)
  chasTier           ChasTier?
  chasSubsidy        Float?   // CHAS subsidy amount
  
  // Other coverage and discounts
  insuranceCovered   Boolean  @default(false)
  discountPercentage Float?   // Available discount percentage
  promotionalPrice   Float?   // Promotional/discounted price
  
  // Service limitations and requirements
  ageRestrictions    Json     @default("{}") // Age-related restrictions
  genderRestrictions String[] @default([])   // Gender restrictions
  appointmentRequired Boolean @default(true)
  walkInAllowed      Boolean  @default(false)
  
  // Operating details
  serviceDays        Json     @default("[]") // Days when service is available
  serviceHours       Json     @default("{}") // Specific service hours
  
  // Quality and rating
  qualityRating      Float?   @default(0)    // Quality score (1-5)
  patientCount       Int      @default(0)    // Total patients served
  
  // Status and metadata
  status             ClinicServiceStatus @default(ACTIVE)
  notes              String?  @db.Text      // Special notes about service
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  clinic   Clinic   @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  service  Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([clinicId, serviceId])
  @@index([isAvailable])
  @@index([isHealthierSGCovered])
  @@index([status])
  @@index([price])
  @@map("clinic_services")
}

model ClinicLanguage {
  id        String   @id @default(cuid())
  clinicId  String
  language  String
  
  createdAt DateTime @default(now())

  clinic Clinic @relation(fields: [clinicId], references: [id], onDelete: Cascade)

  @@unique([clinicId, language])
  @@map("clinic_languages")
}

model OperatingHours {
  id           String   @id @default(cuid())
  clinicId     String
  dayOfWeek    DayOfWeek
  openTime     String    // Format: "HH:mm"
  closeTime    String    // Format: "HH:mm"
  isOpen       Boolean   @default(true)
  breakStart   String?   // Format: "HH:mm"
  breakEnd     String?   // Format: "HH:mm"
  is24Hours    Boolean   @default(false)
  
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  clinic Clinic @relation(fields: [clinicId], references: [id], onDelete: Cascade)

  @@unique([clinicId, dayOfWeek])
  @@map("operating_hours")
}

model ClinicReview {
  id         String   @id @default(cuid())
  clinicId   String
  userId     String?
  rating     Int      @map("rating") // 1-5 stars
  comment    String?  @db.Text
  isVerified Boolean  @default(false) // Verified patient review
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  clinic Clinic  @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  user   User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([clinicId])
  @@index([rating])
  @@map("clinic_reviews")
}

// Doctor Management Models
model Doctor {
  id               String   @id @default(cuid())
  name             String
  email            String?  @unique
  phone            String?
  medicalLicense   String   @unique
  nric             String?  // Singapore NRIC (encrypted)
  
  // Professional information
  specialties      String[] @default([])
  languages        String[] @default([])
  qualifications   String[] @default([])
  experienceYears  Int?
  bio              String?  @db.Text
  
  // Enhanced professional details
  medicalSchool    String?  // Medical school attended
  graduationYear   Int?     // Year of graduation
  specializations  String[] @default([]) // Specific sub-specializations
  boardCertifications String[] @default([]) // Board certifications
  professionalMemberships String[] @default([]) // Professional societies
  
  // Professional achievements and awards
  achievements     String[] @default([]) // Notable achievements
  awards           String[] @default([]) // Awards and recognition
  publications     String[] @default([]) // Research publications
  researchInterests String[] @default([]) // Areas of research
  
  // Career history
  careerHighlights Json     @default("[]") // Career progression details
  previousPositions Json    @default("[]") // Previous roles and positions
  
  // Profile and consultation info
  profileImage     String?
  consultationFee  Float?
  currency         String   @default("SGD")
  
  // Professional status
  isActive         Boolean  @default(true)
  isVerified       Boolean  @default(false)
  verificationDate DateTime?
  verificationNotes String? @db.Text
  
  // Enhanced rating and reviews
  rating           Float?   @default(0)
  reviewCount      Int      @default(0)
  patientSatisfaction Float? // Average patient satisfaction (1-5)
  appointmentCompletionRate Float? // Completion rate percentage
  
  // Analytics and metrics
  totalAppointments Int     @default(0) // Total appointments handled
  specializationPopularity Float? @default(0) // Popularity score
  languagePreference Json   @default("{}") // Language preference analytics
  
  // Privacy and compliance
  privacySettings  Json     @default("{\"profileVisibility\": \"public\", \"contactInfoVisible\": \"private\", \"scheduleVisible\": \"clinic-only\"}")
  gdprConsent      Boolean  @default(false)
  pdpaConsent      Boolean  @default(false)
  lastPrivacyReview DateTime?
  
  // Professional confidentiality
  confidentialityLevel ConfidentialityLevel @default(STANDARD)
  dataRetentionPeriod Int?     // Days to retain data
  
  // Contact preferences
  preferredContactMethod String? // email, phone, sms
  communicationPreferences Json @default("{\"emailNotifications\": true, \"smsReminders\": false}")
  
  // Emergency contact
  emergencyContact  String?
  emergencyPhone    String?
  
  // Professional development
  cmePoints         Int      @default(0) // Continuing medical education points
  lastCMEUpdate     DateTime?
  professionalDevelopment Json @default("[]") // Ongoing education
  
  // Availability preferences
  emergencyAvailability Boolean @default(false)
  onCallSchedule    Json?     // On-call schedule information
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relationships
  clinics          DoctorClinic[]
  specialtiesRel   DoctorSpecialty[]
  availabilities   DoctorAvailability[]
  educationHistory DoctorEducation[]
  certifications   DoctorCertification[]
  memberships      DoctorMembership[]
  awardsRel        DoctorAward[]
  schedules        DoctorSchedule[]
  leaves           DoctorLeave[]
  appointments     DoctorAppointment[]
  searchIndex      DoctorSearchIndex[]
  auditLogs        DoctorAuditLog[]
  expertiseProfile DoctorExpertiseProfile?
  tourismProfile   MedicalTourismProfile?
  doctorSpecialtyConditionMatches DoctorSpecialtyConditionMatch[]

  @@index([medicalLicense])
  @@index([isActive])
  @@index([specialties])
  @@index([rating])
  @@map("doctors")
}

// Healthier SG Eligibility Assessment Models
model EligibilityAssessment {
  id                String   @id @default(cuid())
  userId            String
  
  // Questionnaire responses
  questionnaireResponses Json // Store all questionnaire answers
  
  // Evaluation results
  evaluationResult  Json     // Store evaluation outcome, criteria met/failed, etc.
  eligibilityStatus String   // ELIGIBLE, NOT_ELIGIBLE, CONDITIONAL, PENDING
  
  // Assessment metadata
  assessmentDate    DateTime @default(now())
  assessmentVersion String   @default("1.0")
  isValid           Boolean  @default(true)
  expiresAt         DateTime?
  
  // Assessment details
  ageAtAssessment   Int?
  residencyStatus   String?
  medicalConditions String[] @default([])
  riskProfile       Json?    // Risk assessment data
  
  // Processing metadata
  processedBy       String?  // System or staff ID
  processingNotes   String?  @db.Text
  validationErrors  Json     @default("[]")
  
  // Integration data
  myInfoVerified    Boolean  @default(false)
  myInfoData        Json?    // MyInfo verification data
  integrationData   Json     @default("{}") // Other integration data
  
  // Audit and tracking
  ipAddress         String?
  userAgent         String?
  sessionId         String?
  timeSpentMinutes  Int?     // Time taken to complete
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user              User @relation(fields: [userId], references: [id], onDelete: Cascade)
  appeals           EligibilityAppeal[]

  @@index([userId])
  @@index([assessmentDate])
  @@index([eligibilityStatus])
  @@index([isValid])
  @@map("eligibility_assessments")
}

model EligibilityAppeal {
  id                String   @id @default(cuid())
  userId            String
  assessmentId      String
  
  // Appeal details
  appealReason      String   @db.Text
  additionalContext String?  @db.Text
  
  // Documents and evidence
  supportingDocuments Json   @default("[]") // URLs to supporting documents
  additionalEvidence   Json   @default("[]")
  
  // Appeal status
  status            String   @default("SUBMITTED") // SUBMITTED, UNDER_REVIEW, APPROVED, REJECTED, WITHDRAWN
  priority          String   @default("NORMAL") // LOW, NORMAL, HIGH, URGENT
  
  // Review process
  submittedAt       DateTime @default(now())
  reviewedAt        DateTime?
  reviewedBy        String?  // Staff member who reviewed
  reviewNotes       String?  @db.Text
  
  // Decision details
  decision          String?  // APPROVED, REJECTED, PARTIAL
  decisionReason    String?  @db.Text
  conditions        Json     @default("[]") // Any conditions for approval
  
  // Follow-up actions
  requiresAction    Boolean  @default(false)
  actionItems       Json     @default("[]")
  nextReviewDate    DateTime?
  
  // Notification tracking
  notificationsSent Json     @default("[]")
  communicationLog  Json     @default("[]")
  
  // Integration and metadata
  externalReference String?  // Reference in external system
  metadata          Json     @default("{}")
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user              User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  assessment        EligibilityAssessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([assessmentId])
  @@index([status])
  @@index([submittedAt])
  @@index([reviewedAt])
  @@map("eligibility_appeals")
}

model DoctorClinic {
  id       String   @id @default(cuid())
  doctorId String
  clinicId String
  
  // Assignment details
  role     DoctorRole @default(ATTENDING)
  capacity DoctorCapacity @default(PART_TIME)
  isPrimary Boolean  @default(false) // Primary clinic for this doctor
  
  // Schedule information
  workingDays String[] @default([]) // Days of week
  startTime   String?  // Format: "HH:mm"
  endTime     String?  // Format: "HH:mm"
  
  // Clinic-specific specialization
  clinicSpecializations String[] @default([]) // Specializations at this clinic
  primaryServices       String[] @default([]) // Primary services offered here
  
  // Consultation details
  consultationFee Float?
  consultationDuration Int? // Standard consultation duration in minutes
  emergencyConsultationFee Float? // Emergency consultation fee
  
  // Clinic performance metrics
  clinicRating         Float? // Rating specific to this clinic
  clinicReviewCount    Int    @default(0)
  clinicPatientCount   Int    @default(0)
  
  // Operating details
  appointmentTypes Json @default("[]") // Available appointment types
  walkInAllowed    Boolean @default(false)
  advanceBookingDays Int @default(7) // How far in advance patients can book
  
  // Insurance and payment
  acceptedInsurance Json @default("[]") // Insurance plans accepted
  medisaveAccepted  Boolean @default(false)
  chasAccepted      Boolean @default(false)
  
  // Status and verification
  verificationStatus VerificationStatus @default(PENDING)
  verificationDate   DateTime?
  verificationNotes  String? @db.Text
  
  // Effective dates
  startDate         DateTime @default(now())
  endDate           DateTime?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  doctor  Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  clinic  Clinic @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  schedules DoctorSchedule[]
  leaves DoctorLeave[]

  @@unique([doctorId, clinicId])
  @@index([doctorId])
  @@index([clinicId])
  @@index([role])
  @@map("doctor_clinics")
}

model DoctorSpecialty {
  id      String @id @default(cuid())
  doctorId String
  specialty String
  
  // Specialty details
  subSpecialties String[] @default([]) // Sub-specializations
  expertiseLevel ExpertiseLevel @default(BASIC)
  certificationDate DateTime?
  certificationBody String? // Certifying organization
  
  // Practice details
  yearsPracticing Int? // Years practicing this specialty
  proceduresKnown String[] @default([]) // Specific procedures
  conditionsTreated String[] @default([]) // Conditions treated
  
  // MOH alignment
  mohSpecialtyCode String? // MOH specialty code
  mohCategory     String?  // MOH specialty category
  
  // Performance metrics
  successRate     Float? // Success rate for this specialty
  patientCount    Int    @default(0) // Patients treated in this specialty
  
  // Status
  isActive        Boolean @default(true)
  isVerified      Boolean @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  // Reverse relations for condition and procedure expertise
  conditionExpertise ConditionExpertise[]
  procedureExpertise ProcedureExpertise[]
  treatmentPathways TreatmentPathway[]

  @@unique([doctorId, specialty])
  @@index([doctorId])
  @@index([specialty])
  @@map("doctor_specialties")
}

// Doctor Availability and Schedule Management
model DoctorAvailability {
  id            String   @id @default(cuid())
  doctorId      String
  clinicId      String?
  
  // Date and time information
  date          DateTime
  startTime     String // Format: "HH:mm"
  endTime       String // Format: "HH:mm"
  
  // Availability details
  isAvailable   Boolean @default(true)
  availabilityType AvailabilityType @default(REGULAR)
  appointmentType String? // Regular, emergency, consultation, etc.
  
  // Slot management
  maxAppointments Int? // Maximum appointments for this slot
  bookedAppointments Int @default(0)
  availableSlots   Int @default(1) // Number of concurrent slots
  
  // Location-specific availability
  location      String? // Specific location within clinic
  roomNumber    String? // Room number
  
  // Appointment slots
  slotDuration  Int     @default(30) // Duration per appointment in minutes
  breakDuration Int     @default(0) // Break time between appointments
  bufferTime    Int     @default(0) // Buffer time before/after
  
  // Special availability flags
  isEmergency   Boolean @default(false)
  isWalkIn      Boolean @default(false)
  isTelehealth  Boolean @default(false)
  
  // Conditions and restrictions
  ageRestrictions Json  @default("{}") // Age-specific availability
  genderRestrictions String[] @default([])
  conditionsJson  Json  @default("[]") // Medical conditions
  
  // Status tracking
  status        AvailabilitySlotStatus @default(ACTIVE)
  lastUpdated   DateTime @default(now())
  updatedBy     String? // Staff member who updated
  
  // Notes
  notes         String? @db.Text // Special notes about availability
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  clinic Clinic? @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  appointments DoctorAppointment[] // Added reverse relation

  @@index([doctorId, date])
  @@index([clinicId, date])
  @@index([date, startTime])
  @@index([isAvailable])
  @@index([status])
  @@map("doctor_availabilities")
}

model DoctorSchedule {
  id            String   @id @default(cuid())
  doctorId      String
  doctorClinicId String
  
  // Schedule information
  scheduleType  ScheduleType @default(REGULAR)
  dayOfWeek     DayOfWeek?   // For recurring schedules
  specificDate  DateTime?    // For one-time schedules
  
  // Time details
  startTime     String // Format: "HH:mm"
  endTime       String // Format: "HH:mm"
  breakStart    String? // Format: "HH:mm"
  breakEnd      String? // Format: "HH:mm"
  
  // Schedule scope
  isRecurring   Boolean @default(true)
  recurrencePattern Json @default("{}") // Weekly/monthly pattern
  
  // Special schedule types
  isOnCall      Boolean @default(false)
  isEmergency   Boolean @default(false)
  isTraining    Boolean @default(false) // Professional development
  
  // Effective dates
  effectiveFrom DateTime @default(now())
  effectiveTo   DateTime?
  
  // Status
  isActive      Boolean @default(true)
  isOverride    Boolean @default(false) // Overrides regular schedule
  
  // Notes
  notes         String? @db.Text
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  doctor      Doctor      @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  doctorClinic DoctorClinic @relation(fields: [doctorClinicId], references: [id], onDelete: Cascade)

  @@index([doctorId])
  @@index([doctorClinicId])
  @@index([dayOfWeek])
  @@index([specificDate])
  @@index([isActive])
  @@map("doctor_schedules")
}

model DoctorLeave {
  id            String   @id @default(cuid())
  doctorId      String
  doctorClinicId String?
  
  // Leave details
  leaveType     LeaveType @default(ANNUAL)
  startDate     DateTime
  endDate       DateTime
  
  // Leave information
  reason        String? @db.Text
  isApproved    Boolean @default(false)
  approvedBy    String? // Staff member who approved
  approvedAt    DateTime?
  
  // Emergency coverage
  emergencyCoverage Boolean @default(false)
  coverageNotes  String? @db.Text
  
  // Leave management
  isPaid        Boolean @default(true)
  isHalfDay     Boolean @default(false)
  startTime     String? // Format: "HH:mm" for half-day
  endTime       String? // Format: "HH:mm" for half-day
  
  // Status
  status        LeaveStatus @default(PENDING)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  doctor      Doctor      @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  doctorClinic DoctorClinic? @relation(fields: [doctorClinicId], references: [id], onDelete: Cascade)

  @@index([doctorId, startDate])
  @@index([status])
  @@index([leaveType])
  @@map("doctor_leaves")
}

model DoctorAppointment {
  id            String   @id @default(cuid())
  doctorId      String
  doctorAvailabilityId String?
  
  // Appointment details
  appointmentDate DateTime
  startTime     String // Format: "HH:mm"
  endTime       String // Format: "HH:mm"
  
  // Patient information
  patientId     String? // Patient user ID
  patientName   String? // If not registered
  patientPhone  String?
  patientEmail  String?
  
  // Service details
  serviceId     String?
  appointmentType String?
  urgencyLevel  UrgencyLevel @default(ROUTINE)
  
  // Status tracking
  status        DoctorAppointmentStatus @default(SCHEDULED)
  wasCompleted  Boolean @default(false)
  completionRate Float? // For completed appointments
  
  // Cancellation and rescheduling
  isCancelled   Boolean @default(false)
  cancelledAt   DateTime?
  cancellationReason String? @db.Text
  cancelledBy   String? // Patient or staff
  
  // Rescheduling
  isRescheduled Boolean @default(false)
  originalDate  DateTime?
  originalTime  String?
  rescheduleReason String? @db.Text
  
  // Notes and feedback
  doctorNotes   String? @db.Text
  patientFeedback String? @db.Text
  patientRating Float? // 1-5 rating
  
  // Reminders and notifications
  reminderSent  Boolean @default(false)
  reminderSentAt DateTime?
  confirmationRequired Boolean @default(true)
  
  // Billing
  consultationFee Float?
  isPaid         Boolean @default(false)
  paymentMethod  String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  availability DoctorAvailability? @relation(fields: [doctorAvailabilityId], references: [id], onDelete: SetNull)

  @@index([doctorId, appointmentDate])
  @@index([status])
  @@index([appointmentDate, startTime])
  @@map("doctor_appointments")
}

// Doctor Education and Certification Models
model DoctorEducation {
  id            String   @id @default(cuid())
  doctorId      String
  
  // Education details
  educationType EducationType @default(MEDICAL_SCHOOL)
  institution   String
  degree        String
  fieldOfStudy  String
  
  // Dates
  startDate     DateTime
  endDate       DateTime?
  graduationYear Int?
  
  // Academic achievements
  gpa           Float? // Grade Point Average
  honors        String[] @default([]) // Academic honors
  thesisTitle   String? // For research degrees
  
  // Verification
  isVerified    Boolean @default(false)
  verifiedAt    DateTime?
  verifiedBy    String? // Verification staff member
  
  // Location
  country       String
  city          String?
  
  // Documentation
  certificateUrl String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([doctorId])
  @@index([educationType])
  @@index([graduationYear])
  @@map("doctor_education")
}

model DoctorCertification {
  id            String   @id @default(cuid())
  doctorId      String
  
  // Certification details
  certificationName String
  certificationBody String // Issuing organization
  certificationNumber String?
  
  // Dates
  issueDate     DateTime
  expiryDate    DateTime?
  
  // Certification type
  certificationType CertificationType @default(PROFESSIONAL)
  specialty      String? // Related medical specialty
  
  // Status
  isActive      Boolean @default(true)
  isVerified    Boolean @default(false)
  verifiedAt    DateTime?
  
  // Renewal tracking
  renewalRequired Boolean @default(false)
  renewalNoticeSent Boolean @default(false)
  nextRenewalDate DateTime?
  
  // Documentation
  certificateUrl String?
  verificationNotes String? @db.Text
  
  // Level and scope
  certificationLevel String? // Basic, Advanced, Expert, etc.
  scopeOfPractice    String? @db.Text
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([doctorId])
  @@index([certificationType])
  @@index([expiryDate])
  @@index([isActive])
  @@map("doctor_certifications")
}

model DoctorMembership {
  id            String   @id @default(cuid())
  doctorId      String
  
  // Membership details
  organizationName String
  membershipType   MembershipType @default(PROFESSIONAL)
  membershipLevel  String? // Member, Fellow, Senior, etc.
  
  // Dates
  joinDate      DateTime
  expiryDate    DateTime?
  
  // Status
  isActive      Boolean @default(true)
  isVerified    Boolean @default(false)
  
  // Membership details
  membershipNumber String?
  membershipStatus String?
  
  // Location
  country       String?
  region        String?
  
  // Documentation
  membershipCertificateUrl String?
  
  // Fees and dues
  annualFees    Float?
  lastPaymentDate DateTime?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([doctorId])
  @@index([membershipType])
  @@index([isActive])
  @@map("doctor_memberships")
}

model DoctorAward {
  id            String   @id @default(cuid())
  doctorId      String
  
  // Award details
  awardName     String
  awardingBody  String
  awardCategory String? // Clinical, Research, Teaching, etc.
  
  // Date and recognition
  awardDate     DateTime
  recognitionLevel AwardRecognitionLevel @default(LOCAL)
  
  // Award description
  description   String? @db.Text
  significance  String? @db.Text
  
  // Documentation
  certificateUrl String?
  pressReleaseUrl String?
  
  // Verification
  isVerified    Boolean @default(false)
  verifiedAt    DateTime?
  verifiedBy    String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([doctorId])
  @@index([awardDate])
  @@index([recognitionLevel])
  @@map("doctor_awards")
}

// Doctor Search and Analytics Models
model DoctorSearchIndex {
  id            String   @id @default(cuid())
  doctorId      String
  
  // Search optimization
  searchableName String // Optimized name for search
  searchableBio  String? @db.Text // Optimized biography
  searchKeywords String[] @default([])
  
  // Medical terminology
  medicalTerms  String[] @default([])
  specialtyTerms String[] @default([])
  conditionTerms String[] @default([])
  procedureTerms String[] @default([])
  
  // Multilingual support
  nameTranslations Json @default("{}") // Translations for name
  bioTranslations  Json @default("{}")  // Translations for bio
  searchTranslations Json @default("{}") // Translations for search terms
  
  // Location and accessibility
  serviceAreas  String[] @default([]) // Areas served
  languageKeywords String[] @default([]) // Search terms for languages
  
  // Search boost and ranking
  searchBoost   Float @default(1.0)
  popularityScore Float @default(0.0)
  ratingBoost   Float @default(0.0)
  experienceBoost Float @default(0.0)
  
  // Last index update
  lastIndexed   DateTime @default(now())
  
  createdAt     DateTime @default(now())

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@unique([doctorId])
  @@index([searchBoost])
  @@index([popularityScore])
  @@map("doctor_search_index")
}

model DoctorAuditLog {
  id            String   @id @default(cuid())
  doctorId      String
  
  // Audit details
  action        String // Create, Update, View, Delete, etc.
  fieldName     String? // Specific field that was changed
  oldValue      String? @db.Text // Previous value
  newValue      String? @db.Text // New value
  
  // User information
  performedBy   String? // User ID who performed the action
  userRole      String? // Role of the user
  
  // Context
  ipAddress     String?
  userAgent     String?
  sessionId     String?
  
  // Data classification
  dataSensitivity DataSensitivity @default(STANDARD)
  accessReason  String? @db.Text // Reason for access
  
  // Compliance
  gdprRelevant  Boolean @default(false)
  pdpaRelevant  Boolean @default(false)
  consentVersion String? // Version of consent
  
  timestamp     DateTime @default(now())

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([doctorId])
  @@index([action])
  @@index([timestamp])
  @@index([dataSensitivity])
  @@map("doctor_audit_logs")
}

// Service Taxonomy Models
model ServiceCategory {
  id                String   @id @default(cuid())
  name              String   @unique
  displayName       String
  description       String?  @db.Text
  
  // Hierarchical structure
  parentId          String?  // For hierarchical categories
  level             Int      @default(0)
  sortOrder         Int      @default(0)
  
  // MOH alignment
  mohCodePrefix     String?  // MOH category code prefix
  mohCategoryName   String?  // Official MOH category name
  
  // Healthcare transformation
  htCategory        String?  // Healthcare Transformation category
  htPriority        HTPriority @default(STANDARD)
  
  // Healthier SG alignment
  healthierSGCategory String? // Healthier SG program category
  healthierSGLevel    String? // Priority level in Healthier SG
  
  // Multilingual support
  translations      Json     @default("{}")
  
  // Metadata
  isActive          Boolean  @default(true)
  isSubsidized      Boolean  @default(false)
  priorityLevel     Int      @default(0)
  
  // Statistics (denormalized for performance)
  serviceCount      Int      @default(0)
  averagePrice      Float?   // Average price of services in this category
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // Self-referencing for hierarchy
  parent            ServiceCategory? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children          ServiceCategory[] @relation("CategoryHierarchy")
  
  // Relationships
  services          Service[]
  synonyms          CategorySynonym[]
  
  @@index([parentId])
  @@index([level])
  @@index([isActive])
  @@index([mohCodePrefix])
  @@map("service_categories")
}

model Service {
  id                   String   @id @default(cuid())
  name                 String   @unique
  description          String?  @db.Text
  
  // Enhanced taxonomy
  categoryId           String
  category             ServiceCategory @relation(fields: [categoryId], references: [id])
  subcategory          String?
  specialtyArea        String?
  mohCode              String?  // Singapore MOH service code
  icd10Codes           String[] @default([]) // ICD-10 diagnosis codes
  cptCodes             String[] @default([]) // CPT procedure codes
  
  // Service details
  typicalDurationMin   Int?     // Typical duration in minutes
  complexityLevel      ServiceComplexity @default(BASIC)
  urgencyLevel         UrgencyLevel @default(ROUTINE)
  
  // Pricing structure
  basePrice            Float?   // Base price in SGD
  priceRangeMin        Float?
  priceRangeMax        Float?
  currency             String   @default("SGD")
  isSubsidized         Boolean  @default(false)
  
  // Healthier SG and insurance integration
  isHealthierSGCovered Boolean  @default(false)
  healthierSGServices  String[] @default([])
  medisaveCoverage     Json     @default("{}") // Medisave coverage details
  medishieldCoverage   Json     @default("{}") // Medishield coverage details
  insuranceCoverage    Json     @default("{}") // General insurance coverage
  
  // Enhanced service information
  medicalDescription   String?  @db.Text     // Detailed medical description
  patientFriendlyDesc  String?  @db.Text     // Patient-friendly explanation
  processSteps         Json     @default("[]") // Step-by-step process
  preparationSteps     Json     @default("[]") // Pre-service preparation
  postCareInstructions Json     @default("[]") // Post-service care
  successRates         Json     @default("{}")  // Success rate statistics
  riskFactors          Json     @default("[]")  // Risk factors and contraindications
  
  // Prerequisites and requirements
  ageRequirements      Json     @default("{}") // Age restrictions
  genderRequirements   Json     @default("[]") // Gender-specific requirements
  
  // Multilingual support and search optimization
  translations         Json     @default("{}") // Translations for other languages
  synonyms             String[] @default([])  // Alternative names for search
  searchTerms          String[] @default([])  // Medical terms for discoverability
  commonSearchPhrases  String[] @default([])  // How patients search for this service
  
  // Medical terminology and explanations
  terminology          Json     @default("{}") // Medical terms explanations
  commonQuestions      Json     @default("[]") // FAQ about this service
  
  // Metadata and organization
  isActive             Boolean  @default(true)
  sortOrder            Int      @default(0)
  tags                 String[] @default([])
  priorityLevel        Int      @default(0)    // Display priority
  
  // Analytics and tracking
  viewCount            Int      @default(0)
  bookingCount         Int      @default(0)
  lastBookedAt         DateTime?
  
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Relationships
  clinics              ClinicService[]
  primaryAlternatives  ServiceAlternative[] @relation("PrimaryService")
  alternativeServices  ServiceAlternative[] @relation("AlternativeService")
  prerequisites        ServicePrerequisite[] @relation("ServicePrerequisites")
  requiredFor          ServicePrerequisite[] @relation("RequiredServices")
  availabilities       ServiceAvailability[]
  primaryRelationships ServiceRelationship[] @relation("PrimaryServiceRelation")
  relatedRelationships ServiceRelationship[] @relation("RelatedServiceRelation")
  synonymsRel          ServiceSynonym[]
  mohMapping           ServiceMOHMapping[]
  searchIndex          ServiceSearchIndex[]
  pricingStructure     ServicePricingStructure[]
  checklist            ServiceChecklist[]
  equipment            ServiceEquipment[]
  outcomes             ServiceOutcome[]
  packageItems         ServicePackageItem[]
  referrals            ServiceReferral[]
  expertise            ServiceExpertise[]

  @@index([categoryId])
  @@index([subcategory])
  @@index([isHealthierSGCovered])
  @@index([complexityLevel])
  @@index([urgencyLevel])
  @@index([mohCode])
  @@map("services")
}

model CategorySynonym {
  id                String   @id @default(cuid())
  categoryId        String
  
  // Synonym and search optimization
  term              String
  language          String   @default("en")
  searchBoost       Float    @default(1.0)
  
  createdAt         DateTime @default(now())

  category          ServiceCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, term])
  @@map("category_synonyms")
}

model ServiceAvailability {
  id                 String   @id @default(cuid())
  serviceId          String
  clinicId           String
  
  // Real-time availability tracking
  isAvailable        Boolean  @default(true)
  nextAvailableDate  DateTime?
  estimatedWaitTime  Int?     // Minutes
  
  // Schedule information
  scheduleSlots      Json     @default("[]") // Available time slots
  advanceBookingDays Int      @default(0)
  minimumBookingLead Int      @default(0)    // Minimum hours before booking
  
  // Special availability flags
  isUrgentAvailable  Boolean  @default(false)
  isEmergencySlot    Boolean  @default(false)
  isWalkInAvailable  Boolean  @default(false)
  
  // Capacity and limits
  dailyCapacity      Int?     // Maximum appointments per day
  weeklyCapacity     Int?     // Maximum appointments per week
  currentBookings    Int      @default(0)    // Current booked slots
  
  // Operating hours for this service
  serviceOperatingHours Json @default("{}") // Service-specific hours
  
  // Real-time status
  status             AvailabilityStatus @default(AVAILABLE)
  lastUpdated        DateTime @default(now())
  updatedBy          String?  // Staff member who last updated
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  clinic  Clinic  @relation(fields: [clinicId], references: [id], onDelete: Cascade)

  @@unique([serviceId, clinicId])
  @@index([status])
  @@index([nextAvailableDate])
  @@map("service_availabilities")
}

model ServiceMOHMapping {
  id                String   @id @default(cuid())
  serviceId         String
  
  // Singapore MOH integration
  mohCategoryCode   String   // Official MOH category code
  mohCategoryName   String   // Official MOH category name
  mohSubcategory    String?  // MOH subcategory
  mohCode           String?  // Service code in MOH system
  
  // Healthcare transformation categorization
  htCategory        String?  // Healthcare Transformation category
  htPriority        HTPriority @default(STANDARD)
  
  // Healthier SG alignment
  healthierSGCategory String? // Healthier SG program category
  healthierSGLevel    String? // Priority level in Healthier SG
  
  // Other government program alignments
  screenForLifeCategory String? // Screen for Life program
  chasCategory          String? // Community Health Assist Scheme
  
  effectiveDate      DateTime? // When this mapping became effective
  expiryDate         DateTime? // When this mapping expires
  isActive           Boolean   @default(true)
  lastVerified       DateTime? // Last verified with MOH systems
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([serviceId, mohCategoryCode])
  @@index([mohCategoryCode])
  @@index([htCategory])
  @@map("service_moh_mapping")
}

model ServiceSearchIndex {
  id                String   @id @default(cuid())
  serviceId         String
  
  // Search optimization
  searchableName    String   // Optimized name for search
  searchableDesc    String   @db.Text // Optimized description for search
  searchKeywords    String[] @default([])
  
  // Medical terminology indexing
  medicalTerms      String[] @default([])
  anatomyTerms      String[] @default([])
  conditionTerms    String[] @default([])
  procedureTerms    String[] @default([])
  
  // Popular search phrases
  searchPhrases     String[] @default([]) // Common patient search terms
  
  // Multilingual search support
  searchTranslations Json   @default("{}") // Translations for search terms
  
  // Search boost and ranking
  searchBoost       Float   @default(1.0)  // Boost relevance score
  popularityScore   Float   @default(0.0)  // Based on bookings/views
  
  // Last index update
  lastIndexed       DateTime @default(now())
  
  createdAt         DateTime @default(now())

  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([serviceId])
  @@map("service_search_index")
}

model ServicePricingStructure {
  id                String   @id @default(cuid())
  serviceId         String
  
  // Base pricing
  basePrice         Float    // Base price in SGD
  currency          String   @default("SGD")
  
  // Medisave coverage
  medisaveCovered   Boolean  @default(false)
  medisaveLimit     Float?   // Maximum Medisave amount
  medisavePercentage Float?  // Percentage covered by Medisave
  
  // Medishield coverage
  medishieldCovered Boolean  @default(false)
  medishieldLimit   Float?   // Maximum Medishield amount
  medishieldDeductible Float? // Deductible amount
  
  // Other insurance coverage
  chasCovered       Boolean  @default(false)
  chasTier          ChasTier?
  privateInsurance  Json     @default("[]") // Private insurance coverage
  
  // Government subsidies
  subsidyType       SubsidyType?
  subsidyAmount     Float?
  subsidyPercentage Float?
  
  // Tiered pricing based on service complexity/setting
  pricingTiers      Json     @default("[]") // Different pricing for different tiers
  
  // Effective dates
  effectiveDate     DateTime @default(now())
  expiryDate        DateTime?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([serviceId, effectiveDate])
  @@index([medisaveCovered])
  @@index([medishieldCovered])
  @@map("service_pricing_structure")
}

model ServiceAlternative {
  id                String            @id @default(cuid())
  primaryServiceId  String
  alternativeServiceId String
  
  // Alternative relationship details
  relationshipType  AlternativeType   @default(ALTERNATIVE)
  similarityScore   Float             @default(0)
  comparisonNotes   String?           @db.Text
  
  createdAt         DateTime          @default(now())

  primaryService    Service @relation("PrimaryService", fields: [primaryServiceId], references: [id], onDelete: Cascade)
  alternativeService Service @relation("AlternativeService", fields: [alternativeServiceId], references: [id], onDelete: Cascade)

  @@unique([primaryServiceId, alternativeServiceId])
  @@map("service_alternatives")
}

model ServicePrerequisite {
  id                String   @id @default(cuid())
  serviceId         String
  prerequisiteServiceId String
  
  // Prerequisites relationship
  prerequisiteType  PrerequisiteType @default(REQUIRED)
  description       String?  @db.Text
  timeFrameMin      Int?     // Days before service
  isOptional        Boolean  @default(false)
  
  createdAt         DateTime @default(now())

  service           Service @relation("ServicePrerequisites", fields: [serviceId], references: [id], onDelete: Cascade)
  prerequisiteService Service @relation("RequiredServices", fields: [prerequisiteServiceId], references: [id], onDelete: Cascade)

  @@unique([serviceId, prerequisiteServiceId])
  @@map("service_prerequisites")
}

model ServiceRelationship {
  id                String   @id @default(cuid())
  primaryServiceId  String
  relatedServiceId  String
  
  // Relationship mapping
  relationshipType  ServiceRelationshipType @default(COMPLEMENTARY)
  strength          Float   @default(1.0)   // Relationship strength (0-1)
  description       String? @db.Text
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  primaryService    Service @relation("PrimaryServiceRelation", fields: [primaryServiceId], references: [id], onDelete: Cascade)
  relatedService    Service @relation("RelatedServiceRelation", fields: [relatedServiceId], references: [id], onDelete: Cascade)

  @@unique([primaryServiceId, relatedServiceId])
  @@index([relationshipType])
  @@map("service_relationships")
}

model ServiceSynonym {
  id                String   @id @default(cuid())
  serviceId         String
  
  // Synonym and search optimization
  term              String
  termType          SynonymType @default(ALTERNATE_NAME)
  language          String   @default("en")
  searchBoost       Float    @default(1.0)   // Boost search relevance
  
  createdAt         DateTime @default(now())

  service           Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([serviceId, term])
  @@index([termType])
  @@index([language])
  @@map("service_synonyms")
}

model ServiceTag {
  id                String   @id @default(cuid())
  name              String   @unique
  category          String?  // Tag category (e.g., "specialty", "urgency", "age_group")
  description       String?  @db.Text
  
  // Tag hierarchy
  parentTagId       String?
  level             Int      @default(0)
  sortOrder         Int      @default(0)
  
  // Usage statistics
  usageCount        Int      @default(0)
  isActive          Boolean  @default(true)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  parentTag         ServiceTag? @relation("TagHierarchy", fields: [parentTagId], references: [id], onDelete: SetNull)
  childTags         ServiceTag[] @relation("TagHierarchy")
  
  @@index([category])
  @@index([parentTagId])
  @@map("service_tags")
}

model ServiceChecklist {
  id          String   @id @default(cuid())
  serviceId   String
  
  // Checklist items
  category    ChecklistCategory
  item        String
  description String?  @db.Text
  isRequired  Boolean  @default(false)
  
  // Multilingual support
  translations Json   @default("{}")
  
  // Order and metadata
  orderIndex  Int      @default(0)
  
  // Item-specific details
  timeframe   String?  // When to do this (e.g., "2 hours before", "1 day before")
  priority    ChecklistPriority @default(MEDIUM)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId, category])
  @@map("service_checklists")
}

model ServiceEquipment {
  id          String   @id @default(cuid())
  serviceId   String
  
  // Equipment information
  equipmentName String
  equipmentType EquipmentType @default(GENERAL)
  isRequired    Boolean      @default(true)
  
  // Usage details
  usageNotes   String?      @db.Text
  maintenanceSchedule Json?  @default("{}")
  
  // Supplier information
  supplierName String?
  modelNumber  String?
  serialNumber String?
  
  // Usage statistics
  usageCount   Int         @default(0)
  lastUsed     DateTime?
  
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId, equipmentType])
  @@map("service_equipment")
}

model ServiceOutcome {
  id                String   @id @default(cuid())
  serviceId         String
  
  // Outcome information
  outcomeType       OutcomeType
  description       String   @db.Text
  
  // Effectiveness metrics
  successRate       Float?   // Percentage (0-100)
  patientSatisfaction Float? // Rating (1-5)
  
  // Recovery information
  recoveryTime      String?  // Expected recovery time
  followUpRequired  Boolean  @default(false)
  followUpTimeframe String?  // When follow-up is needed
  
  // Risk information
  riskLevel         RiskLevel @default(LOW)
  complications     Json     @default("[]") // Possible complications
  
  // Patient education
  patientEducation  String?  @db.Text
  
  // Multilingual support
  translations      Json     @default("{}")
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId, outcomeType])
  @@index([successRate])
  @@map("service_outcomes")
}

// Service Package Models
model ServicePackage {
  id                String   @id @default(cuid())
  
  // Package information
  name              String
  description       String?  @db.Text
  packageType       PackageType @default(BUNDLE)
  
  // Pricing
  originalPrice     Float?   // Sum of individual prices
  packagePrice      Float    // Total package price
  discountAmount    Float?   // Discount amount
  discountPercent   Float?   // Discount percentage
  
  // Package details
  validityPeriod    Int?     // Days package is valid
  maxUsage          Int?     // Maximum times can be used
  isActive          Boolean  @default(true)
  
  // Booking settings
  requiresAppointment Boolean @default(true)
  bookingWindow      Int?     // Days ahead to book
  
  // Patient requirements
  ageRestrictions   Json?    @default("{}")
  genderRestrictions Json?   @default("{}")
  medicalConditions Json?    @default("[]")
  
  // Package metadata
  imageUrl          String?
  tags              String[] @default([])
  
  // Usage tracking
  totalBookings     Int      @default(0)
  patientRating     Float?   // Average rating
  patientReviews    Int      @default(0)
  
  // Timestamps
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relationships
  items             ServicePackageItem[]
  bookings          PackageBooking[]
  reviews           PackageReview[]

  @@index([packageType])
  @@index([isActive])
  @@index([createdAt])
  @@map("service_packages")
}

model PackageBooking {
  id                String   @id @default(cuid())
  
  // Booking details
  packageId         String
  userId            String
  clinicId          String?
  serviceId         String?
  
  // Usage tracking
  totalSessions     Int      // Total sessions in package
  usedSessions      Int      @default(0) // Used sessions
  remainingSessions Int      // Calculated: totalSessions - usedSessions
  
  // Booking dates
  bookingDate       DateTime @default(now())
  startDate         DateTime // When package becomes active
  expiryDate        DateTime? // When package expires
  lastUsed          DateTime?
  
  // Status
  status            PackageBookingStatus @default(ACTIVE)
  isActive          Boolean  @default(true)
  
  // Financial details
  amountPaid        Float    @default(0)
  paymentMethod     String?
  
  // Booking metadata
  bookingNotes      String?  @db.Text
  cancellationReason String? @db.Text
  cancelledAt       DateTime?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  package           ServicePackage @relation(fields: [packageId], references: [id], onDelete: Cascade)
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([packageId])
  @@index([status])
  @@map("package_bookings")
}

model PackageReview {
  id                String   @id @default(cuid())
  
  // Review details
  packageId         String
  userId            String
  
  // Ratings
  overallRating     Float    // Overall package rating (1-5)
  serviceQuality    Float?   // Service quality rating (1-5)
  valueForMoney     Float?   // Value for money rating (1-5)
  convenience       Float?   // Convenience rating (1-5)
  
  // Review content
  title             String?
  review            String   @db.Text
  
  // Review metadata
  isVerified        Boolean  @default(false) // Verified booking
  isPublic          Boolean  @default(true)
  helpfulVotes      Int      @default(0)
  
  // Response from clinic
  clinicResponse    String?  @db.Text
  respondedAt       DateTime?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  package           ServicePackage @relation(fields: [packageId], references: [id], onDelete: Cascade)
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([packageId, userId])
  @@index([overallRating])
  @@index([createdAt])
  @@map("package_reviews")
}

model ServicePackageItem {
  id                String   @id @default(cuid())
  packageId         String
  
  // Service reference
  serviceId         String
  serviceName       String   // Denormalized for performance
  
  // Usage details
  includedSessions  Int      @default(1) // How many times this service is included
  isOptional        Boolean  @default(false)
  
  // Order in package
  orderIndex        Int      @default(0)
  
  // Service-specific pricing for package
  packagePrice      Float?   // Price for this service in package (if different)
  regularPrice      Float?   // Regular service price
  
  // Usage tracking
  usedSessions      Int      @default(0)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  package           ServicePackage @relation(fields: [packageId], references: [id], onDelete: Cascade)
  service           Service        @relation(fields: [serviceId], references: [id])

  @@unique([packageId, serviceId])
  @@index([packageId, orderIndex])
  @@map("service_package_items")
}

// Referral System Models
model ServiceReferral {
  id                String       @id @default(cuid())
  
  // Referral participants
  referringClinicId String
  referredClinicId  String
  serviceId         String
  
  // Patient information (if available)
  patientId         String?
  patientName       String?      // If not registered
  patientEmail      String?
  patientPhone      String?
  
  // Referral details
  referralType      ReferralType @default(SERVICE_SPECIALIZATION)
  urgencyLevel      ReferralUrgency @default(ROUTINE)
  status            ReferralStatus @default(PENDING)
  
  // Clinical information
  clinicalNotes     String?      @db.Text
  diagnosisCodes    String[]     @default([])
  symptoms          String[]     @default([])
  previousTreatments Json?       @default("[]")
  
  // Appointment coordination
  requestedDate     DateTime?
  preferredDoctor   String?
  specialRequests   String?      @db.Text
  
  // Communication tracking
  referralSentAt    DateTime?
  referralReceivedAt DateTime?
  responseReceivedAt DateTime?
  
  // Completion tracking
  appointmentDate   DateTime?
  appointmentCompletedAt DateTime?
  followUpRequired  Boolean @default(false)
  followUpNotes     String?  @db.Text
  
  // Quality metrics
  patientSatisfaction Float?
  timeToAppointment  Int?     // Days between referral and appointment
  wasSuccessful      Boolean?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  referringClinic   Clinic   @relation("ReferringClinic", fields: [referringClinicId], references: [id])
  referredClinic    Clinic   @relation("ReferredClinic", fields: [referredClinicId], references: [id])
  service           Service  @relation(fields: [serviceId], references: [id])
  patient           User?    @relation(fields: [patientId], references: [id], onDelete: SetNull)
  documents         ReferralDocument[]

  @@index([referringClinicId])
  @@index([referredClinicId])
  @@index([serviceId])
  @@index([status])
  @@index([createdAt])
  @@map("service_referrals")
}

model ReferralDocument {
  id                String   @id @default(cuid())
  referralId        String
  
  // Document information
  documentType      ReferralDocumentType
  fileName          String
  fileUrl           String
  fileSize          Int
  mimeType          String
  
  // Document details
  description       String?
  isConfidential    Boolean  @default(true)
  
  // Processing status
  isProcessed       Boolean  @default(false)
  processedAt       DateTime?
  processingNotes   String?  @db.Text
  
  // Access control
  uploadedBy        String   // User ID
  accessLevel       DocumentAccessLevel @default(REFERRING_CLINIC)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  referral          ServiceReferral @relation(fields: [referralId], references: [id], onDelete: Cascade)

  @@index([referralId])
  @@index([documentType])
  @@map("referral_documents")
}

// Clinic Expertise Models
model ServiceExpertise {
  id                String       @id @default(cuid())
  clinicId          String
  
  // Expertise details
  serviceId         String
  expertiseLevel    ExpertiseLevel
  
  // Certification information
  certificationBody String?
  certificationDate DateTime?
  certificationNumber String?
  
  // Performance metrics
  totalProcedures   Int      @default(0)
  successRate       Float?   // Percentage (0-100)
  complicationRate  Float?   // Percentage (0-100)
  patientSatisfaction Float? // Average rating (1-5)
  
  // Experience tracking
  yearsOfExperience Int      @default(0)
  lastPerformed     DateTime?
  
  // Specialization details
  subspecialty      String?   // Specific area of expertise
  techniquesUsed    String[]  @default([]) // Specific techniques/clinics
  
  // Qualification details
  minimumQualifications Json?  @default("[]")
  equipmentRequired    Json?   @default("[]")
  
  // Status and verification
  isActive          Boolean   @default(true)
  isVerified        Boolean   @default(false)
  verifiedAt        DateTime?
  verifiedBy        String?   // Staff member who verified
  
  // Patient access
  requiresReferral  Boolean   @default(false)
  insuranceCoverage Json?     @default("[]") // Accepted insurance plans
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  clinic            Clinic    @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  service           Service   @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  certifications    ExpertiseCertification[]

  @@unique([clinicId, serviceId])
  @@index([clinicId, expertiseLevel])
  @@index([isActive, isVerified])
  @@map("service_expertise")
}

model ExpertiseCertification {
  id                String   @id @default(cuid())
  expertiseId       String
  
  // Certification information
  certificationName String
  certificationBody String
  certificateNumber String?
  
  // Certification details
  certificationType CertificationType @default(PROFESSIONAL)
  issueDate         DateTime
  expiryDate        DateTime?
  
  // Verification
  isVerified        Boolean  @default(false)
  verificationDate  DateTime?
  verificationNotes String?  @db.Text
  
  // Document reference
  certificateUrl    String?
  
  // Renewal tracking
  renewalRequired   Boolean  @default(false)
  renewalNoticeSent Boolean  @default(false)
  nextRenewalDate   DateTime?
  
  // International recognition
  internationalRecognition Boolean @default(false)
  regionRecognized   String? // Region where recognized (e.g., "ASEAN", "International")
  mutualRecognitionAgreement Boolean @default(false) // Part of MRA
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  expertise         ServiceExpertise @relation(fields: [expertiseId], references: [id], onDelete: Cascade)

  @@index([expertiseId])
  @@index([certificationType])
  @@index([internationalRecognition])
  @@map("expertise_certifications")
}

// Medical Expertise and Specialization Models
model ConditionExpertise {
  id                String   @id @default(cuid())
  doctorSpecialtyId String
  
  // Condition details
  conditionName     String   // Medical condition name
  conditionCode     String?  // ICD-10 or other medical coding
  icd10Code         String?  // ICD-10 diagnosis code
  medicalTerm       String?  // Medical terminology
  commonName        String?  // Patient-friendly name
  
  // Expertise level
  expertiseLevel    ExpertiseLevel @default(BASIC)
  confidenceLevel   Float?   // Doctor's confidence level (1-5)
  treatmentSuccessRate Float? // Success rate for this condition
  patientCount      Int      @default(0) // Patients treated
  
  // Treatment details
  treatmentApproaches Json  @default("[]") // Treatment approaches used
  firstLineTreatments String[] @default([])
  alternativeTreatments String[] @default([])
  referralCriteria   String? @db.Text // When to refer to specialist
  
  // Experience tracking
  yearsExperience   Int      @default(0) // Years treating this condition
  lastTreatedDate   DateTime? // Last time treated this condition
  complexCasesHandled Int    @default(0) // Complex cases handled
  
  // Specializations
  subspecialty      String?  // Specific subspecialty for this condition
  isRareCondition   Boolean  @default(false)
  requiresSpecialTraining Boolean @default(false)
  
  // Verification and status
  isVerified        Boolean  @default(false)
  verificationDate  DateTime?
  verificationNotes String?  @db.Text
  
  // Patient education
  providesEducation Boolean  @default(false)
  patientResources  Json     @default("[]") // Patient education materials
  educationalApproach String? @db.Text
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  doctorSpecialty   DoctorSpecialty @relation(fields: [doctorSpecialtyId], references: [id], onDelete: Cascade)

  @@unique([doctorSpecialtyId, conditionName])
  @@index([conditionCode])
  @@index([icd10Code])
  @@index([isRareCondition])
  @@map("condition_expertise")
}

model ProcedureExpertise {
  id                String   @id @default(cuid())
  doctorSpecialtyId String
  
  // Procedure details
  procedureName     String   // Medical procedure name
  procedureCode     String?  // CPT or other procedural coding
  cptCode           String?  // CPT procedural code
  category          String   // Procedure category (Surgical, Diagnostic, etc.)
  complexityLevel   ServiceComplexity @default(BASIC)
  
  // Expertise details
  proficiencyLevel  ExpertiseLevel @default(BASIC)
  successRate       Float?   // Success rate for this procedure
  complicationRate  Float?   // Complication rate
  patientCount      Int      @default(0) // Patients treated
  
  // Experience tracking
  yearsExperience   Int      @default(0) // Years performing this procedure
  frequencyPerYear  Int?     // How often performed per year
  lastPerformedDate DateTime? // Last time performed
  
  // Technique and approach
  techniquesUsed    Json     @default("[]") // Specific techniques used
  equipmentUsed     String[] @default([])   // Equipment/technology used
  latestTechnology  Boolean  @default(false) // Uses latest technology
  minimallyInvasive Boolean  @default(false) // Uses minimally invasive approach
  
  // Preparation and recovery
  averagePrepTime   Int?     // Average preparation time in minutes
  averageDuration   Int?     // Average procedure duration in minutes
  averageRecoveryTime Float? // Average recovery time in days
  
  // Special requirements
  requiresSpecialCertification Boolean @default(false)
  certificationRequired String[] @default([]) // Required certifications
  trainingHoursRequired Int?    // Training hours required
  
  // Quality metrics
  patientSatisfaction Float? // Patient satisfaction rating
  peerReviewScore    Float?  // Peer review score
  complicationManagement Boolean @default(false) // Can manage complications
  
  // International standards
  meetsInternationalStandards Boolean @default(false)
  qualityCertifications String[] @default([])
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  doctorSpecialty   DoctorSpecialty @relation(fields: [doctorSpecialtyId], references: [id], onDelete: Cascade)

  @@unique([doctorSpecialtyId, procedureName])
  @@index([procedureCode])
  @@index([cptCode])
  @@index([category])
  @@index([complexityLevel])
  @@map("procedure_expertise")
}

model TreatmentPathway {
  id                String   @id @default(cuid())
  doctorSpecialtyId String
  
  // Pathway details
  pathwayName       String   // Treatment pathway name
  pathwayType       String   // Type of pathway (Standard, Complex, Experimental)
  conditionGroup    String   // Group of conditions this pathway treats
  evidenceLevel     String?  // Level of evidence (A, B, C, etc.)
  
  // Pathway components
  steps             Json     @default("[]") // Step-by-step treatment plan
  duration          String?  // Expected duration
  phases            Json     @default("[]") // Treatment phases
  
  // Success metrics
  successRate       Float?   // Overall pathway success rate
  completionRate    Float?   // Pathway completion rate
  patientSatisfaction Float? // Patient satisfaction
  qualityOfLifeImprovement Float? // Quality of life improvement score
  
  // Complexity and requirements
  complexityScore   Int      @default(1) // Complexity score (1-10)
  requiresMultidisciplinary Boolean @default(false) // Requires team approach
  requiresSpecialEquipment Boolean @default(false) // Special equipment needed
  requiresAdvancedTraining Boolean @default(false) // Advanced training required
  
  // Monitoring and follow-up
  monitoringProtocol Json @default("[]") // Monitoring requirements
  followUpSchedule  Json @default("[]") // Follow-up schedule
  outcomeMeasures   Json @default("[]") // How outcomes are measured
  
  // Patient selection criteria
  inclusionCriteria Json @default("[]") // Patient inclusion criteria
  exclusionCriteria Json @default("[]") // Patient exclusion criteria
  contraindications String[] @default([])
  
  // Adaptation and personalization
  canBePersonalized Boolean @default(false) // Can be personalized
  genomicMarkers    Json @default("[]") // Genetic/genomic considerations
  patientFactors    Json @default("[]") // Patient-specific factors
  
  // International standards and guidelines
  internationalGuidelines String[] @default([]) // Following which guidelines
  complianceStandard String? // Compliance standard followed
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  doctorSpecialty   DoctorSpecialty @relation(fields: [doctorSpecialtyId], references: [id], onDelete: Cascade)

  @@unique([doctorSpecialtyId, pathwayName])
  @@index([pathwayType])
  @@index([conditionGroup])
  @@index([evidenceLevel])
  @@map("treatment_pathways")
}

model DoctorExpertiseProfile {
  id                String   @id @default(cuid())
  doctorId          String   @unique
  
  // Professional summary
  expertiseSummary  String?  @db.Text // Summary of overall expertise
  careerHighlights  Json     @default("[]") // Key career achievements
  uniqueSkills      String[] @default([])   // Unique skills and capabilities
  
  // Clinical expertise summary
  primaryExpertiseAreas String[] @default([]) // Primary areas of expertise
  secondaryExpertiseAreas String[] @default([]) // Secondary areas
  emergingExpertise  String[] @default([]) // Emerging areas of expertise
  
  // Experience metrics
  totalExperienceYears Int   @default(0) // Total years of practice
  yearsInPrimarySpecialty Int @default(0) // Years in primary specialty
  yearsInCurrentRole    Int   @default(0) // Years in current role
  
  // Case complexity expertise
  handlesComplexCases Boolean @default(false) // Can handle complex cases
  handlesRareDiseases Boolean @default(false) // Can handle rare diseases
  handlesPediatricCases Boolean @default(false) // Pediatric cases
  handlesGeriatricCases Boolean @default(false) // Geriatric cases
  
  // Multidisciplinary collaboration
  collaboratesMultidisciplinary Boolean @default(false)
  leadsMedicalTeams    Boolean @default(false)
  mentorsOtherDoctors  Boolean @default(false)
  researchCollaborator Boolean @default(false)
  
  // International and cultural competence
  internationalExperience Boolean @default(false)
  culturalCompetency      Boolean @default(false)
  languageExpertise      Json     @default("[]") // Medical terminology in languages
  globalHealthExperience Boolean @default(false)
  
  // Teaching and research
  teachesMedicalStudents Boolean @default(false)
  supervisesResidents    Boolean @default(false)
  continuingEducation    Boolean @default(false)
  peerEducation         Boolean @default(false)
  
  // Quality and safety
  qualityImprovement     Boolean @default(false)
  patientSafetyLeadership Boolean @default(false)
  clinicalGovernance     Boolean @default(false)
  auditParticipation     Boolean @default(false)
  
  // Innovation and technology
  earlyAdopter           Boolean @default(false) // Early adopter of new technology
  digitalHealthExpertise Boolean @default(false)
  telemedicineExpertise  Boolean @default(false)
  aiAssistedDiagnostics  Boolean @default(false)
  
  // Professional development
  learningGoalOrientated Boolean @default(false)
  professionalNetwork   Boolean @default(false) // Strong professional network
  thoughtLeader         Boolean @default(false)
  publicSpeaker         Boolean @default(false)
  
  // Patient-centered care
  patientAdvocate       Boolean @default(false)
  holisticApproach      Boolean @default(false)
  familyCenteredCare    Boolean @default(false)
  sharedDecisionMaking  Boolean @default(false)
  
  // Specific achievements
  awards                String[] @default([]) // Awards and recognition
  publications          Int      @default(0)  // Research publications
  presentations         Int      @default(0)  // Conference presentations
  mediaAppearances      Int      @default(0)  // Media interviews/articles
  
  // Professional philosophy
  approachToMedicine    String?  @db.Text
  patientCarePhilosophy String?  @db.Text
  researchInterests     String[] @default([])
  
  // Recognition and validation
  peerRecognition       Float?   @default(0) // Score from peers
  patientRecommendationRate Float? @default(0) // Patient recommendation rate
  professionalEndorsements String[] @default([]) // Endorsements from colleagues
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  doctor                Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@map("doctor_expertise_profiles")
}

model MedicalTourismProfile {
  id                String   @id @default(cuid())
  doctorId          String   @unique
  
  // International qualification recognition
  internationalQualifications Json @default("[]") // List of international qualifications
  recognizedByCountries String[] @default([]) // Countries that recognize qualifications
  mutualRecognitionAgreements String[] @default([]) // MRA countries
  
  // Cultural competence
  culturalCompetencyTraining Boolean @default(false)
  culturalAwarenessScore    Float?   @default(0) // Cultural awareness rating
  experienceWithExpatriates Boolean @default(false)
  experienceWithTourists    Boolean @default(false)
  religiousSensitivity      Boolean @default(false)
  
  // Language support
  medicalLanguages     String[] @default([]) // Languages with medical proficiency
  translationServices  Boolean  @default(false)
  interpreterAvailable Boolean  @default(false)
  patientEducationInMultipleLanguages Boolean @default(false)
  
  // Healthcare system navigation
  internationalHealthcareNavigation Boolean @default(false)
  insuranceGuidance     Boolean @default(false)
  billingSupport        Boolean @default(false)
  appointmentScheduling Boolean @default(false)
  
  // Medical tourism services
  medicalTourismServices String[] @default([]) // Specific services for medical tourists
  conciergeServices     Boolean @default(false)
  coordinationServices  Boolean @default(false)
  followUpCarePlanning  Boolean @default(false)
  
  // Documentation and communication
  medicalRecordsInEnglish Boolean @default(false)
  communicationProtocols Boolean @default(false)
  emergencyCommunication  Boolean @default(false)
  familyCommunication     Boolean @default(false)
  
  // Payment and insurance
  acceptsInternationalInsurance Boolean @default(false)
  medicaidAcceptance      Boolean @default(false)
  directBillingServices   Boolean @default(false)
  financialCounseling     Boolean @default(false)
  
  // Travel and logistics support
  travelCoordination      Boolean @default(false)
  accommodationGuidance   Boolean @default(false)
  localTransportation     Boolean @default(false)
  visaGuidance           Boolean @default(false)
  
  // Quality assurance
  internationalQualityStandards Boolean @default(false)
  accreditationCompliance Boolean @default(false)
  patientSafetyProtocols  Boolean @default(false)
  qualityMonitoring       Boolean @default(false)
  
  // Partnership and referrals
  internationalPartnerships Json @default("[]") // Partnerships with international providers
  referralNetworks        Json @default("[]")   // International referral networks
  collaborationAgreements Json @default("[]")   // Collaboration agreements
  
  // Experience tracking
  internationalPatientsServed Int @default(0) // Number of international patients
  countriesRepresented    Json @default("[]") // Countries of origin of patients
  patientSatisfactionScore Float? @default(0) // International patient satisfaction
  
  // Compliance and regulations
  internationalCompliance Boolean @default(false)
  dataProtectionCompliance Boolean @default(false) // International data protection
  medicalTourismLicensing  Boolean @default(false)
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  doctor                Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@map("medical_tourism_profiles")
}

model SpecialtyMatcher {
  id                String   @id @default(cuid())
  conditionName     String
  conditionCode     String?  // ICD-10 or other coding
  symptoms          String[] @default([])
  
  // Recommended specialties
  primarySpecialty  String   // Primary recommended specialty
  secondarySpecialties String[] @default([]) // Alternative specialties
  subspecialties    String[] @default([])
  
  // Matching criteria
  expertiseRequired ExpertiseLevel @default(INTERMEDIATE)
  urgencyLevel      UrgencyLevel @default(ROUTINE)
  complexityLevel   ServiceComplexity @default(MODERATE)
  
  // Treatment pathways
  standardPathway   String?  // Standard treatment pathway
  alternativePathways String[] @default([])
  referralCriteria  Json     @default("[]") // When referral is needed
  
  // Success factors
  successRateFactors Json @default("[]") // Factors that contribute to success
  qualityIndicators  Json @default("[]") // Quality indicators to look for
  
  // Patient factors
  ageConsiderations Json @default("[]") // Age-specific considerations
  genderConsiderations Json @default("[]") // Gender-specific considerations
  culturalConsiderations Json @default("[]") // Cultural considerations
  
  // Geographic and availability
  availabilityScore Float?  @default(0) // Availability of specialists
  geographicConsiderations Json @default("[]") // Geographic factors
  
  // Outcome predictions
  predictedSuccessRate Float? // Predicted success rate
  averageTreatmentDuration Float? // Average treatment duration
  followUpRequired    Boolean @default(false)
  
  // Cost and insurance
  estimatedCostRange Json @default("{}") // Cost range estimates
  insuranceCoverage  Json @default("[]") // Insurance coverage options
  
  // Verification and validation
  evidenceLevel      String? // Level of evidence for matching
  validationStatus   String  @default("PENDING")
  lastValidated      DateTime?
  validationNotes    String? @db.Text
  
  // Machine learning and AI
  confidenceScore    Float?  @default(0) // AI confidence in matching
  recommendationStrength String? // Strength of recommendation
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@unique([conditionName, conditionCode])
  @@index([conditionCode])
  @@index([primarySpecialty])
  @@index([expertiseRequired])
  @@map("specialty_matchers")
}

model DoctorSpecialtyConditionMatch {
  id                String   @id @default(cuid())
  doctorId          String
  specialtyId       String
  conditionName     String
  
  // Match details
  matchStrength     Float    // Strength of match (0-1)
  expertiseLevel    ExpertiseLevel
  confidenceScore   Float    // Confidence in treatment (0-5)
  
  // Treatment approach
  treatmentApproach String?  @db.Text // Description of treatment approach
  successRate       Float?   // Predicted success rate for this doctor
  patientSatisfaction Float? // Expected patient satisfaction
  
  // Experience and outcome
  similarCasesCount Int      @default(0) // Number of similar cases treated
  lastSimilarCase   DateTime? // Date of last similar case
  outcomes          Json     @default("[]") // Historical outcomes
  
  // Recommendations
  isRecommended     Boolean  @default(false)
  recommendationRank Int?    // Rank among recommendations
  recommendationReason String? @db.Text
  
  // Special considerations
  uniqueExpertise   String[] @default([]) // Unique expertise for this condition
  specializations   String[] @default([]) // Relevant specializations
  treatmentOptions  Json     @default("[]") // Available treatment options
  
  // Availability and access
  appointmentAvailability String? // Availability assessment
  referralRequired  Boolean  @default(false) // Self-referral allowed?
  waitTimeEstimate  Int?     // Estimated wait time in days
  
  // Quality indicators
  qualityScore      Float?   @default(0) // Overall quality score
  peerRating        Float?   @default(0) // Peer rating
  patientRating     Float?   @default(0) // Patient rating
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@unique([doctorId, specialtyId, conditionName])
  @@index([doctorId])
  @@index([conditionName])
  @@index([matchStrength])
  @@index([isRecommended])
  @@map("doctor_specialty_condition_matches")
}

// Healthier SG Program Models
model HealthierSGProgram {
  id             String   @id @default(cuid())
  name           String   @unique
  displayName    String
  description    String?  @db.Text
  category       HealthierSGCategory
  
  // Program details
  eligibilityCriteria Json   @default("{}")
  requirements       Json   @default("{}")
  
  // Program status
  isActive         Boolean @default(true)
  isMandatory      Boolean @default(false) // Mandatory participation
  startDate        DateTime?
  endDate          DateTime?
  launchDate       DateTime?
  
  // Government integration
  programCode      String  @unique // Official program code
  mohProgramId     String? // MOH program identifier
  governmentUrl    String?
  legislationReference String? // Legal basis
  
  // Performance tracking
  participationTargets Json @default("{}") // Target participation rates
  successMetrics     Json @default("[]") // Key performance indicators
  reportingFrequency HealthierSGReportingFrequency @default(MONTHLY)
  
  // Administration
  responsibleMinistry String? // Responsible government ministry
  programManager      String? // Program manager contact
  budgetAllocation    Float?  // Budget in SGD
  lastUpdated         DateTime @default(now())
  version             String   @default("1.0")
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relationships
  enrollments      ProgramEnrollment[]
  eligibilityRules ProgramEligibilityRule[]
  benefits         ProgramBenefit[]
  clinicParticipation ClinicParticipation[]
  auditLogs        HealthierSGAuditLog[]
  outcomes         ProgramOutcome[]

  @@index([category])
  @@index([isActive])
  @@index([programCode])
  @@map("healthier_sg_programs")
}

// Program Enrollment and Participation Tracking
model ProgramEnrollment {
  id                String   @id @default(cuid())
  userId            String
  programId         String
  clinicId          String?
  doctorId          String?
  
  // Enrollment details
  enrollmentDate    DateTime @default(now())
  enrollmentMethod  HealthierSGEnrollmentMethod
  enrollmentSource  String   // How they enrolled (online, clinic, referral)
  enrollmentChannel String   // Specific channel used
  
  // Status tracking
  status            HealthierSGEnrollmentStatus @default(ACTIVE)
  effectiveFrom     DateTime @default(now())
  effectiveTo       DateTime?
  suspensionReason  String?  @db.Text
  suspensionDate    DateTime?
  
  // Verification and validation
  isVerified        Boolean  @default(false)
  verifiedAt        DateTime?
  verifiedBy        String?  // Staff member ID
  verificationNotes String?  @db.Text
  
  // Compliance tracking
  consentGiven      Boolean  @default(false)
  consentDate       DateTime?
  dataSharingConsent Boolean @default(false)
  termsAccepted     Boolean  @default(false)
  
  // Personal information validation
  nricVerified      Boolean  @default(false)
  addressVerified   Boolean  @default(false)
  contactVerified   Boolean  @default(false)
  identityVerified  Boolean  @default(false)
  
  // Program-specific enrollment data
  enrollmentData    Json     @default("{}") // Custom enrollment fields
  specialNeeds      Json     @default("{}") // Accessibility requirements
  languagePreference String  @default("en")
  
  // Progress tracking
  lastActivityDate  DateTime?
  completionStatus  Json     @default("{}") // Progress milestones
  
  // Communication preferences
  preferredCommunication String[] @default(["email"])
  reminderPreferences   Json     @default("{}")
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relationships
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  program           HealthierSGProgram @relation(fields: [programId], references: [id], onDelete: Cascade)
  clinic            Clinic?            @relation(fields: [clinicId], references: [id], onDelete: SetNull)
  doctor            Doctor?            @relation(fields: [doctorId], references: [id], onDelete: SetNull)
  benefits          EnrolledBenefit[]
  activities        ProgramActivity[]
  milestones        ProgramMilestone[]
  documents         EnrollmentDocument[]
  auditLogs         HealthierSGAuditLog[]

  @@index([userId, programId])
  @@index([status])
  @@index([enrollmentDate])
  @@index([clinicId])
  @@index([doctorId])
  @@unique([userId, programId])
  @@map("program_enrollments")
}

// Eligibility Rules and Criteria Management
model ProgramEligibilityRule {
  id                String   @id @default(cuid())
  programId         String
  ruleName          String
  ruleType          HealthierSGEligibilityRuleType
  
  // Rule definition
  ruleLogic         Json     @default("{}") // Complex eligibility logic
  conditions        Json     @default("[]") // Specific conditions
  evaluationOrder   Int      @default(1)    // Order of rule evaluation
  
  // Rule categories
  demographicRules  Json     @default("[]") // Age, gender, etc.
  medicalRules      Json     @default("[]") // Medical conditions
  geographicRules   Json     @default("[]") // Location-based rules
  socioeconomicRules Json    @default("[]") // Income, employment, etc.
  behavioralRules   Json     @default("[]") // Lifestyle factors
  
  // Dynamic evaluation
  isDynamic         Boolean  @default(false) // Can change over time
  recalculationFrequency HealthierSGRecalculationFrequency @default(MONTHLY)
  lastEvaluated     DateTime?
  nextEvaluation    DateTime?
  
  // Rule metadata
  ruleDescription   String?  @db.Text
  examples          Json     @default("[]") // Example scenarios
  exceptions        Json     @default("[]") // Rule exceptions
  
  // Government compliance
  mohRequired       Boolean  @default(false) // MOH mandated rule
  legislativeBasis  String?  // Legal basis for rule
  reviewDate        DateTime?
  
  // Performance and monitoring
  isActive          Boolean  @default(true)
  successRate       Float?   // How often rule correctly identifies eligibility
  falsePositiveRate Float?   // Incorrectly included rate
  falseNegativeRate Float?   // Incorrectly excluded rate
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  program           HealthierSGProgram @relation(fields: [programId], references: [id], onDelete: Cascade)
  evaluations       EligibilityEvaluation[]

  @@index([programId])
  @@index([ruleType])
  @@index([isActive])
  @@map("program_eligibility_rules")
}

// Eligibility Evaluation Tracking
model EligibilityEvaluation {
  id                  String   @id @default(cuid())
  enrollmentId        String
  ruleId              String
  
  // Evaluation details
  evaluationDate      DateTime @default(now())
  evaluationType      HealthierSGEvaluationType @default(INITIAL)
  
  // Results
  result              HealthierSGEvaluationResult
  score               Float?   // Confidence score (0-100)
  reason              String?  @db.Text // Explanation of decision
  
  // Data evaluated
  evaluatedData       Json     @default("{}") // Data used in evaluation
  sourceSystems       String[] @default([]) // Data sources consulted
  
  // Validation
  validationRequired  Boolean  @default(false)
  validatedBy         String?  // Staff member ID
  validationDate      DateTime?
  validationNotes     String?  @db.Text
  
  // Appeal process
  canBeAppealed       Boolean  @default(true)
  appealDeadline      DateTime?
  appealStatus        String?  // PENDING, APPROVED, REJECTED
  
  // Automated vs manual
  isAutomated         Boolean  @default(true)
  automationConfidence Float?  // Confidence in automated decision
  requiresReview      Boolean  @default(false)
  
  // Audit trail
  decisionFactors     Json     @default("[]") // Factors that influenced decision
  alternativeOutcomes Json     @default("[]") // What if different data was used
  
  createdAt           DateTime @default(now())

  enrollment          ProgramEnrollment     @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  rule                ProgramEligibilityRule @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  @@index([enrollmentId])
  @@index([ruleId])
  @@index([evaluationDate])
  @@map("eligibility_evaluations")
}

// Program Benefits and Incentives
model ProgramBenefit {
  id                String   @id @default(cuid())
  programId         String
  benefitName       String
  benefitType       HealthierSGBenefitType
  
  // Benefit details
  description       String?  @db.Text
  benefitValue      Float?   // Monetary value in SGD
  benefitUnit       String?  // "per_visit", "monthly", "annual", etc.
  maxBenefitAmount  Float?   // Maximum total benefit
  maxBenefitFrequency Int?   // How often can be claimed
  
  // Qualification criteria
  qualificationCriteria Json @default("[]")
  waitingPeriod       Int?   // Days before benefit becomes available
  
  // Program mechanics
  isRecurring        Boolean @default(false)
  isStackable        Boolean @default(false) // Can combine with other benefits
  isTransferable     Boolean @default(false)
  expirationPeriod   Int?    // Days until benefit expires
  
  // Integration details
  paymentMechanism   HealthierSGBenefitPaymentMechanism
  serviceCategories  String[] @default([]) // Eligible service categories
  mohServiceCodes    String[] @default([]) // MOH service codes
  
  // Status and metadata
  isActive           Boolean @default(true)
  effectiveFrom      DateTime @default(now())
  effectiveTo        DateTime?
  lastClaimDate      DateTime?
  
  // Compliance and reporting
  governmentFunded   Boolean @default(true)
  reportingRequired  Boolean @default(true)
  auditTrail         Boolean @default(true)
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  program            HealthierSGProgram @relation(fields: [programId], references: [id], onDelete: Cascade)
  enrolledBenefits   EnrolledBenefit[]
  claims             BenefitClaim[]

  @@index([programId])
  @@index([benefitType])
  @@index([isActive])
  @@map("program_benefits")
}

// Enrolled Benefits Tracking
model EnrolledBenefit {
  id                String   @id @default(cuid())
  enrollmentId      String
  benefitId         String
  
  // Enrollment in benefit
  enrollmentDate    DateTime @default(now())
  activationDate    DateTime?
  qualificationDate DateTime? // When eligibility was confirmed
  
  // Status tracking
  status            HealthierSGBenefitStatus @default(ACTIVE)
  isActive          Boolean  @default(true)
  suspensionReason  String?  @db.Text
  suspensionDate    DateTime?
  
  // Usage tracking
  totalClaimsMade   Int      @default(0)
  totalAmountClaimed Float   @default(0)
  remainingBalance  Float?   // Remaining benefit amount
  
  // Next claim eligibility
  nextClaimDate     DateTime?
  claimFrequency    String?  // "monthly", "quarterly", etc.
  
  // Personalization
  customizedTerms   Json     @default("{}") // Personalized benefit terms
  specialConditions Json     @default("[]") // Special conditions
  
  // Communication
  notificationPreferences Json @default("{}")
  lastNotificationDate DateTime?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  enrollment        ProgramEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  benefit           ProgramBenefit    @relation(fields: [benefitId], references: [id], onDelete: Cascade)
  claims            BenefitClaim[]

  @@unique([enrollmentId, benefitId])
  @@index([status])
  @@map("enrolled_benefits")
}

// Benefit Claims Processing - moved to comprehensive model below (lines 5006-5066)

// Clinic Participation and Verification
model ClinicParticipation {
  id                String   @id @default(cuid())
  clinicId          String
  programId         String
  
  // Participation details
  participationType HealthierSGClinicParticipationType
  participationDate DateTime @default(now())
  effectiveFrom     DateTime @default(now())
  effectiveTo       DateTime?
  
  // Status tracking
  status            HealthierSGClinicStatus @default(PENDING)
  accreditationLevel HealthierSGClinicAccreditation?
  
  // Verification process
  isVerified        Boolean  @default(false)
  verifiedAt        DateTime?
  verifiedBy        String?  // Government verifier ID
  verificationNotes String?  @db.Text
  
  // Capacity and scope
  serviceScope      Json     @default("[]") // Services covered by program
  patientCapacity   Int?     // Maximum patients per day/month
  geographicCoverage String[] @default([]) // Areas served
  
  // Compliance requirements
  complianceStandards Json   @default("[]") // Standards to maintain
  reportingRequirements Json @default("[]") // Required reports
  qualityMetrics     Json     @default("[]") // Quality indicators
  
  // Training and certification
  staffTrainingRequired Boolean @default(true)
  trainingCompletedDate DateTime?
  certificationExpiry   DateTime?
  lastTrainingUpdate    DateTime?
  
  // Performance metrics
  performanceScore  Float?   @default(0) // Overall performance rating
  patientSatisfaction Float? @default(0) // Patient satisfaction score
  complianceScore   Float?   @default(0) // Compliance rating
  
  // Financial details
  reimbursementRate Float?   // Reimbursement rate percentage
  additionalFunding Float?   // Additional funding received
  costSharing       Json     @default("{}") // Cost sharing arrangements
  
  // Support and resources
  supportResources  Json     @default("[]") // Resources provided by government
  technicalSupport  Boolean  @default(false)
  onboardingSupport Boolean  @default(false)
  
  // Communication and reporting
  reportingFrequency HealthierSGReportingFrequency @default(MONTHLY)
  lastReportDate     DateTime?
  nextReportDue      DateTime?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  clinic            Clinic             @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  program           HealthierSGProgram @relation(fields: [programId], references: [id], onDelete: Cascade)
  performanceMetrics ClinicPerformanceMetric[]
  audits            ClinicAudit[]

  @@unique([clinicId, programId])
  @@index([status])
  @@index([participationDate])
  @@map("clinic_participation")
}

// Clinic Performance Tracking
model ClinicPerformanceMetric {
  id                String   @id @default(cuid())
  clinicParticipationId String
  metricPeriod      HealthierSGMetricPeriod
  periodStart       DateTime
  periodEnd         DateTime
  
  // Performance metrics
  patientCount      Int      @default(0) // Total patients served
  enrollmentCount   Int      @default(0) // New enrollments
  completionRate    Float?   @default(0) // Program completion rate
  satisfactionScore Float?   @default(0) // Patient satisfaction
  
  // Quality metrics
  qualityScore      Float?   @default(0) // Overall quality rating
  safetyIncidents   Int      @default(0) // Safety incidents
  complianceScore   Float?   @default(0) // Compliance rating
  
  // Financial metrics
  totalClaims       Int      @default(0) // Total benefit claims
  approvedClaims    Int      @default(0) // Approved claims
  reimbursementAmount Float? @default(0) // Total reimbursement
  
  // Efficiency metrics
  averageWaitTime   Float?   @default(0) // Average wait time in minutes
  appointmentUtilization Float? @default(0) // Appointment slot utilization
  staffProductivity Float?   @default(0) // Staff productivity score
  
  // Outcomes
  healthOutcomes    Json     @default("[]") // Health outcome improvements
  costEffectiveness Float?   @default(0)   // Cost per positive outcome
  preventiveCare    Int      @default(0)   // Preventive care interventions
  
  // Comparison metrics
  benchmarkComparison Json   @default("{}") // Comparison to benchmarks
  peerRanking        Int?    // Ranking among participating clinics
  trendDirection     String? // IMPROVING, STABLE, DECLINING
  
  // Reporting status
  isReported         Boolean @default(false)
  reportedAt         DateTime?
  reportNotes        String? @db.Text
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  clinicParticipation ClinicParticipation @relation(fields: [clinicParticipationId], references: [id], onDelete: Cascade)

  @@index([clinicParticipationId])
  @@index([periodStart, periodEnd])
  @@map("clinic_performance_metrics")
}

// Health Profile Integration
model HealthProfile {
  id                String   @id @default(cuid())
  userId            String   @unique
  
  // Basic health information
  height            Float?   // in cm
  weight            Float?   // in kg
  bloodPressureSystolic Int?  // Systolic BP
  bloodPressureDiastolic Int? // Diastolic BP
  heartRate         Int?     // Resting heart rate
  temperature       Float?   // Body temperature in Celsius
  
  // Health conditions
  chronicConditions String[] @default([]) // List of chronic conditions
  currentMedications String[] @default([]) // Current medications
  allergies         String[] @default([]) // Known allergies
  familyHistory     String[] @default([]) // Family medical history
  
  // Lifestyle factors
  smokingStatus     HealthierSGSmokingStatus
  alcoholConsumption String? // Alcohol consumption frequency
  exerciseFrequency HealthierSGExerciseFrequency
  dietType          String?  // Diet type (vegetarian, vegan, etc.)
  
  // Mental health
  mentalHealthConditions String[] @default([])
  stressLevel       HealthierSGStressLevel?
  sleepHours        Float?   // Average sleep hours per night
  
  // Screening status
  cancerScreenings  Json     @default("{}") // Cancer screening status
  diabetesScreening Json     @default("{}") // Diabetes screening status
  cardiovascularScreening Json @default("{}") // Heart disease screening
  
  // Risk assessments
  cardiovascularRisk Json   @default("{}") // CV risk assessment
  diabetesRisk       Json   @default("{}") // Diabetes risk assessment
  cancerRisk         Json   @default("{}") // Cancer risk assessment
  
  // Program-specific data
  programEligibilityScores Json @default("{}") // Scores for different programs
  riskFactors        Json     @default("[]") // Modifiable risk factors
  protectiveFactors  Json     @default("[]") // Health protective factors
  
  // Health goals
  primaryHealthGoal  String?  @db.Text
  healthGoals        Json     @default("[]") // Specific health goals
  targetMetrics      Json     @default("{}") // Target health metrics
  
  // Data quality and verification
  dataCompleteness   Float?   @default(0) // Percentage of data fields completed
  lastUpdated        DateTime @default(now())
  updatedBy          String?  // Who last updated the profile
  verificationStatus String   @default("PENDING")
  
  // Privacy and sharing
  sharingPreferences Json     @default("{}") // What data can be shared
  consentForResearch Boolean  @default(false)
  dataRetentionPeriod Int?    // Days to retain data
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Relationships
  user               User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  assessments        HealthAssessment[]
  goals              HealthGoal[]
  activities         HealthActivity[]

  @@index([userId])
  @@map("health_profiles")
}

// Health Assessments
model HealthAssessment {
  id                String   @id @default(cuid())
  healthProfileId   String
  assessmentType    HealthierSGAssessmentType
  assessmentDate    DateTime @default(now())
  
  // Assessment details
  assessmentTool    String   // Tool or questionnaire used
  score             Float?   // Overall assessment score
  result            String?  @db.Text // Assessment result description
  
  // Assessment data
  responses         Json     @default("{}") // Individual question responses
  clinicalData      Json     @default("{}") // Clinical measurements
  observations      String?  @db.Text // Healthcare provider observations
  
  // Risk stratification
  riskLevel         HealthierSGRiskLevel?
  riskFactors       Json     @default("[]") // Identified risk factors
  recommendations   Json     @default("[]") // Recommended actions
  
  // Follow-up requirements
  followUpRequired  Boolean  @default(false)
  followUpDate      DateTime?
  followUpNotes     String?  @db.Text
  
  // Integration with programs
  programRecommendations Json @default("[]") // Recommended programs
  eligibilityImpact      Json @default("[]")  // Impact on program eligibility
  
  // Quality and validation
  validatedBy       String?  // Healthcare provider ID
  validationDate    DateTime?
  qualityScore      Float?   // Assessment quality rating
  
  // Metadata
  completedBy       String?  // Who completed the assessment
  completionMethod  String?  // How assessment was completed
  timeSpentMinutes  Int?     // Time taken to complete
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  healthProfile     HealthProfile @relation(fields: [healthProfileId], references: [id], onDelete: Cascade)

  @@index([healthProfileId])
  @@index([assessmentType])
  @@index([assessmentDate])
  @@map("health_assessments")
}

// Program Activities and Milestones
model ProgramActivity {
  id                String   @id @default(cuid())
  enrollmentId      String
  activityType      HealthierSGActivityType
  
  // Activity details
  activityName      String
  description       String?  @db.Text
  scheduledDate     DateTime?
  completedDate     DateTime?
  
  // Activity data
  activityData      Json     @default("{}") // Activity-specific data
  results           Json     @default("{}") // Activity results
  metrics           Json     @default("{}") // Key metrics
  
  // Status and progress
  status            HealthierSGActivityStatus @default(SCHEDULED)
  progress          Float?   @default(0) // Progress percentage (0-100)
  
  // Service information
  serviceId         String?
  clinicId          String?
  doctorId          String?
  appointmentId     String?
  
  // Documentation
  documents         String[] @default([]) // Related document URLs
  notes             String?  @db.Text // Activity notes
  
  // Quality and outcomes
  qualityScore      Float?   // Quality rating (1-5)
  outcomeScore      Float?   // Outcome rating (1-5)
  patientFeedback   String?  @db.Text
  
  // Compliance tracking
  complianceStatus  String?  // COMPLIANT, NON_COMPLIANT, PENDING
  complianceNotes   String?  @db.Text
  
  // Integration points
  benefitImpact     Json     @default("{}") // Impact on benefits
  programProgress   Json     @default("{}") // Progress toward goals
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  enrollment        ProgramEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)

  @@index([enrollmentId])
  @@index([activityType])
  @@index([status])
  @@map("program_activities")
}

// Program Milestones
model ProgramMilestone {
  id                String   @id @default(cuid())
  enrollmentId      String
  milestoneType     HealthierSGMilestoneType
  
  // Milestone details
  milestoneName     String
  description       String?  @db.Text
  targetDate        DateTime?
  achievedDate      DateTime?
  
  // Achievement tracking
  isAchieved        Boolean  @default(false)
  achievementScore  Float?   @default(0) // Score achieved (0-100)
  completionLevel   Float?   @default(0) // Completion percentage
  
  // Requirements and criteria
  requirements      Json     @default("[]") // Requirements for achievement
  criteria          Json     @default("{}") // Achievement criteria
  
  // Benefits and rewards
  unlockBenefits    Json     @default("[]") // Benefits unlocked by milestone
  rewardType        String?  // Type of reward
  rewardValue       Float?   // Monetary value of reward
  
  // Progress tracking
  progressData      Json     @default("{}") // Detailed progress information
  timeSpent         Int?     // Total time spent (minutes)
  effortLevel       String?  // Level of effort required
  
  // Verification
  verificationRequired Boolean @default(true)
  verifiedBy         String?  // Who verified achievement
  verificationDate   DateTime?
  verificationNotes  String?  @db.Text
  
  // Impact assessment
  healthImpact      Json     @default("{}") // Health impact assessment
  programImpact     Json     @default("{}") // Impact on program progress
  futureRelevance   String?  @db.Text // Relevance for future goals
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  enrollment        ProgramEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)

  @@index([enrollmentId])
  @@index([milestoneType])
  @@index([isAchieved])
  @@map("program_milestones")
}

// Program Outcomes Tracking
model ProgramOutcome {
  id                String   @id @default(cuid())
  programId         String
  outcomeType       HealthierSGOutcomeType
  
  // Outcome details
  outcomeName       String
  description       String?  @db.Text
  measurementMethod String?  // How outcome is measured
  
  // Outcome metrics
  targetValue       Float?   // Target outcome value
  achievedValue     Float?   // Actually achieved value
  improvement       Float?   // Improvement from baseline
  
  // Time-based tracking
  baselineDate      DateTime?
  measurementDate   DateTime @default(now())
  followUpDate      DateTime?
  
  // Individual vs population level
  isIndividual      Boolean  @default(true)
  populationSegment String?  // Specific population segment
  sampleSize        Int?     // For population outcomes
  
  // Quality and reliability
  reliabilityScore  Float?   @default(0) // Reliability of measurement
  dataQuality       Float?   @default(0) // Quality of data
  confidenceInterval Json    @default("{}") // Statistical confidence
  
  // Statistical analysis
  statisticalSignificance Float? // P-value or confidence level
  effectSize        Float?   // Effect size of intervention
  confidenceLevel   Float?   // Confidence level of results
  
  // Cost-effectiveness
  costPerOutcome    Float?   // Cost per unit of outcome
  costEffectivenessRatio Float? // Cost-effectiveness ratio
  roi               Float?   // Return on investment
  
  // Qualitative outcomes
  qualitativeData   Json     @default("{}") // Qualitative feedback
  patientExperience Json     @default("{}") // Patient experience data
  stakeholderFeedback Json   @default("[]") // Stakeholder feedback
  
  // Program improvement insights
  keyLearnings      Json     @default("[]") // Key learnings from outcomes
  improvementSuggestions Json @default("[]") // Suggestions for improvement
  scalabilityAssessment Json @default("{}") // Assessment of scalability
  
  // Government reporting
  reportToGovernment Boolean @default(true)
  reportData         Json     @default("{}") // Data for government reports
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  program           HealthierSGProgram @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@index([programId])
  @@index([outcomeType])
  @@index([measurementDate])
  @@map("program_outcomes")
}

// Health Goals Tracking
model HealthGoal {
  id                String   @id @default(cuid())
  healthProfileId   String
  goalType          HealthierSGGoalType
  
  // Goal details
  goalName          String
  description       String?  @db.Text
  targetValue       Float?   // Target value to achieve
  currentValue      Float?   // Current value
  baselineValue     Float?   // Starting value
  
  // Goal framework
  smartCriteria     Json     @default("{}") // SMART goal criteria
  goalCategory      String?  // Category of goal
  priority          HealthierSGGoalPriority @default(MEDIUM)
  
  // Timeline
  targetDate        DateTime
  createdDate       DateTime @default(now())
  reviewDate        DateTime?
  completionDate    DateTime?
  
  // Progress tracking
  progress          Float?   @default(0) // Progress percentage
  milestones        Json     @default("[]") // Milestone checkpoints
  progressNotes     String?  @db.Text // Progress notes
  
  // Strategies and support
  strategies        Json     @default("[]") // Strategies to achieve goal
  supportResources  Json     @default("[]") // Resources to support goal
  barriers          Json     @default("[]") // Potential barriers
  solutions         Json     @default("[]") // Solutions to barriers
  
  // Accountability and tracking
  accountability    String?  // Who is responsible (patient, doctor, etc.)
  trackingFrequency String?  // How often progress is tracked
  lastTrackingDate  DateTime?
  trackingMethod    String?  // How progress is measured
  
  // Integration with programs
  programLinks      Json     @default("[]") // Connected programs
  benefitImpact     Json     @default("{}") // Impact on benefits
  enrollmentEligibility Json @default("[]") // Effect on enrollment
  
  // Success criteria
  successCriteria   Json     @default("[]") // Criteria for goal success
  successMeasures   Json     @default("[]") // How success is measured
  sustainabilityPlan Json    @default("{}") // Plan for maintaining success
  
  // Status and review
  status            HealthierSGGoalStatus @default(ACTIVE)
  statusNotes       String?  @db.Text // Notes about current status
  reviewNotes       String?  @db.Text // Notes from last review
  nextReviewDate    DateTime?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  healthProfile     HealthProfile @relation(fields: [healthProfileId], references: [id], onDelete: Cascade)

  @@index([healthProfileId])
  @@index([goalType])
  @@index([status])
  @@map("health_goals")
}

// Health Activity Tracking
model HealthActivity {
  id                String   @id @default(cuid())
  healthProfileId   String
  activityType      HealthierSGActivityType
  
  // Activity details
  activityName      String
  description       String?  @db.Text
  activityDate      DateTime @default(now())
  duration          Int?     // Duration in minutes
  
  // Activity data
  activityValue     Float?   // Quantified value (steps, calories, etc.)
  activityMetrics   Json     @default("{}") // Additional metrics
  
  // Health impact
  healthImpact      Json     @default("{}") // Impact on health metrics
  goalContribution  Json     @default("{}") // Contribution to goals
  programProgress   Json     @default("{}") // Progress toward program milestones
  
  // Context and setting
  location          String?  // Where activity took place
  circumstances     String?  @db.Text // Circumstances of activity
  environmentalFactors Json @default("{}") // Environmental factors
  
  // Motivation and adherence
  motivationLevel   HealthierSGMotivationLevel?
  difficultyLevel   HealthierSGDifficultyLevel?
  satisfaction      HealthierSGSatisfactionLevel?
  
  // Barriers and facilitators
  barriers          Json     @default("[]") // Barriers encountered
  facilitators      Json     @default("[]") // Factors that helped
  supportReceived   Json     @default("{}") // Support received
  
  // Integration with care plan
  carePlanAlignment Json     @default("[]") // Alignment with care plan
  providerInvolvement String? // Healthcare provider involved
  
  // Quality and verification
  verifiedBy        String?  // Who verified activity
  verificationMethod String? // How activity was verified
  dataSource        String?  // Source of activity data
  
  // Follow-up actions
  followUpRequired  Boolean  @default(false)
  followUpNotes     String?  @db.Text
  nextActivity      String?  @db.Text // Planned next activity
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  healthProfile     HealthProfile @relation(fields: [healthProfileId], references: [id], onDelete: Cascade)

  @@index([healthProfileId])
  @@index([activityType])
  @@index([activityDate])
  @@map("health_activities")
}

// Compliance and Audit Tracking
model HealthierSGAuditLog {
  id                String   @id @default(cuid())
  programId         String?
  enrollmentId      String?
  
  // Audit details
  action            HealthierSGAuditAction
  entityType        String   // Type of entity (enrollment, claim, etc.)
  entityId          String?  // ID of the entity
  changes           Json     @default("{}") // What was changed
  
  // User information
  performedBy       String?  // User ID who performed action
  performedByRole   String?  // Role of the user
  sessionId         String?  // Session identifier
  
  // Context information
  ipAddress         String?
  userAgent         String?
  timestamp         DateTime @default(now())
  
  // Data classification
  dataSensitivity   HealthierSGAuditDataSensitivity @default(INTERNAL)
  accessReason      String?  @db.Text // Reason for access
  
  // Compliance tracking
  gdprRelevant      Boolean  @default(false)
  pdpaRelevant      Boolean  @default(false)
  mohCompliance     Boolean  @default(false)
  
  // Audit trail
  previousValues    Json     @default("{}") // Previous values
  newValues         Json     @default("{}") // New values
  validationStatus  String?  // Status of data validation
  
  // Government reporting
  reportToGovernment Boolean @default(false)
  governmentReportId String? // ID in government system
  reportingDeadline  DateTime?
  
  // Risk and monitoring
  riskLevel         HealthierSGAuditRiskLevel @default(LOW)
  flags             String[] @default([]) // Flags indicating issues
  alerts            Json     @default("[]") // Alerts generated
  
  // Resolution tracking
  resolutionStatus  String?  // PENDING, RESOLVED, ESCALATED
  resolutionNotes   String?  @db.Text
  resolvedBy        String?  // User who resolved
  resolvedAt        DateTime?
  
  createdAt         DateTime @default(now())

  // Relationships
  program           HealthierSGProgram? @relation(fields: [programId], references: [id], onDelete: SetNull)
  enrollment        ProgramEnrollment?  @relation(fields: [enrollmentId], references: [id], onDelete: SetNull)

  @@index([programId])
  @@index([enrollmentId])
  @@index([action])
  @@index([timestamp])
  @@map("healthier_sg_audit_logs")
}

// Clinic Compliance Audits
model ClinicAudit {
  id                String   @id @default(cuid())
  clinicParticipationId String
  auditType         HealthierSGAuditType
  auditPeriod       String   // Period being audited (e.g., "2024-Q1")
  
  // Audit details
  auditDate         DateTime @default(now())
  auditorName       String?  // Name of auditor
  auditorOrganization String? // Organization conducting audit
  
  // Audit scope
  auditScope        Json     @default("[]") // Areas covered in audit
  complianceStandards Json   @default("[]") // Standards assessed
  
  // Findings
  overallScore      Float?   @default(0) // Overall compliance score
  criticalFindings  Int      @default(0) // Number of critical findings
  majorFindings     Int      @default(0) // Number of major findings
  minorFindings     Int      @default(0) // Number of minor findings
  
  // Detailed findings
  detailedFindings  Json     @default("[]") // Detailed audit findings
  recommendations   Json     @default("[]") // Recommendations for improvement
  bestPractices     Json     @default("[]") // Best practices identified
  
  // Performance metrics
  patientSafety     Float?   @default(0) // Patient safety score
  dataQuality       Float?   @default(0) // Data quality score
  programCompliance Float?   @default(0) // Program compliance score
  
  // Action items
  actionItems       Json     @default("[]") // Required actions
  dueDate           DateTime?
  priority          HealthierSGAuditPriority @default(MEDIUM)
  
  // Follow-up
  followUpRequired  Boolean  @default(false)
  followUpDate      DateTime?
  resolutionStatus  String?  // Status of resolving issues
  
  // Certification and status
  certificationStatus String? // Status of certification
  accreditationLevel String? // Accreditation level achieved
  complianceCertificate String? // Certificate URL
  
  // Report and documentation
  auditReport       String?  @db.Text // Detailed audit report
  supportingDocuments String[] @default([]) // Supporting documents
  evidenceFiles     String[] @default([]) // Evidence files
  
  // Government reporting
  reportToGovernment Boolean @default(true)
  governmentReference String? // Reference in government system
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  clinicParticipation ClinicParticipation @relation(fields: [clinicParticipationId], references: [id], onDelete: Cascade)

  @@index([clinicParticipationId])
  @@index([auditType])
  @@index([auditDate])
  @@map("clinic_audits")
}

// Enrollment Documents Management
model EnrollmentDocument {
  id                String   @id @default(cuid())
  enrollmentId      String
  
  // Document details
  documentType      HealthierSGDocumentType
  documentName      String
  description       String?  @db.Text
  
  // File information
  fileUrl           String
  fileName          String
  fileSize          Int
  mimeType          String
  fileHash          String?  // For integrity verification
  
  // Upload and status
  uploadedAt        DateTime @default(now())
  uploadedBy        String?  // User who uploaded
  verificationStatus HealthierSGDocumentVerificationStatus @default(PENDING)
  verifiedAt        DateTime?
  verifiedBy        String?  // Staff member who verified
  
  // Document lifecycle
  expiryDate        DateTime?
  renewalRequired   Boolean  @default(false)
  lastRenewalDate   DateTime?
  nextRenewalDate   DateTime?
  
  // Compliance and validation
  complianceRequired Boolean @default(true)
  digitalSignature  Boolean  @default(false)
  digitalSignatureValid Boolean? // Validation of digital signature
  
  // Access control
  accessLevel       HealthierSGDocumentAccessLevel @default(RESTRICTED)
  sharedWith        String[] @default([]) // Additional users with access
  
  // Metadata
  tags              String[] @default([])
  classification    String?  // Document classification level
  retentionPeriod   Int?     // Days to retain document
  
  // Version control
  version           Int      @default(1)
  previousVersionId String?  // Link to previous version
  isCurrent         Boolean  @default(true)
  
  // Audit trail
  auditLog          Json     @default("[]") // Access and modification log
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  enrollment        ProgramEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)

  @@index([enrollmentId])
  @@index([documentType])
  @@index([verificationStatus])
  @@unique([enrollmentId, documentType])
  @@map("enrollment_documents")
}

// Communication Models
model Enquiry {
  id               String       @id @default(cuid())
  
  // Contact information
  userId           String?
  clinicId         String?
  name             String
  email            String
  phone            String?
  subject          String
  message          String       @db.Text
  
  // Enquiry details
  enquiryType      EnquiryType
  preferredLanguage String      @default("en")
  priority         Priority     @default(NORMAL)
  status           EnquiryStatus @default(NEW)
  
  // Staff assignment
  assignedTo       String?
  repliedAt        DateTime?
  resolution       String?      @db.Text
  
  // Metadata
  source           String       @default("website") // website, phone, email
  tags             String[]     @default([])
  isPublic         Boolean      @default(false) // For FAQ purposes
  
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  // Relationships
  user             User?        @relation(fields: [userId], references: [id], onDelete: SetNull)
  clinic           Clinic?      @relation(fields: [clinicId], references: [id], onDelete: SetNull)

  @@index([status])
  @@index([priority])
  @@index([enquiryType])
  @@index([createdAt])
  @@map("enquiries")
}

// System Support Models
model SearchLog {
  id               String   @id @default(cuid())
  userId           String?
  sessionId        String
  searchQuery      String
  searchFilters    Json     @default("{}")
  resultsCount     Int      @default(0)
  clickedResults   String[] @default([]) // Array of clicked clinic/doctor IDs
  responseTimeMs   Int?
  timestamp        DateTime @default(now())

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([sessionId])
  @@index([timestamp])
  @@index([userId])
  @@map("search_logs")
}

model AuditLog {
  id                String   @id @default(cuid())
  userId            String?
  sessionId         String?
  
  // Enhanced audit information
  action            String   // CREATE, READ, UPDATE, DELETE, LOGIN, LOGOUT, etc.
  resource          String   // e.g., "clinic", "doctor", "enquiry", "health_record"
  resourceId        String?
  oldValue          Json?    // Previous value (for updates)
  newValue          Json?    // New value (for creates/updates)
  
  // Context and metadata
  details           Json     @default("{}")
  ipAddress         String?
  userAgent         String?
  requestId         String?  // Unique request identifier
  correlationId     String?  // For tracking related operations
  
  // Compliance and security
  dataSensitivity   DataSensitivity @default(STANDARD)
  complianceFramework String[] @default([]) // PDPA, GDPR, HIPAA, etc.
  accessReason      String?  @db.Text // Reason for accessing data
  isPrivileged      Boolean  @default(false)
  consentRequired   Boolean  @default(false)
  consentGiven      Boolean? // Whether consent was provided
  
  // Government and regulatory
  isGovernmentRequest Boolean @default(false)
  governmentAgency   String?  // Which government agency made the request
  regulatoryReference String? // Reference to regulatory requirements
  legalBasis         String?  // Legal basis for processing
  
  // Audit trail
  timestamp         DateTime @default(now())
  isDeleted         Boolean  @default(false)
  deletedAt         DateTime?
  deletedBy         String?
  
  // Relationships
  user              User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  securityEvents    SecurityEvent[]

  @@index([userId])
  @@index([resource])
  @@index([timestamp])
  @@index([action])
  @@index([dataSensitivity])
  @@index([complianceFramework])
  @@map("audit_logs")
}

// Consent Management for PDPA Compliance
model ConsentRecord {
  id                String   @id @default(cuid())
  userId            String
  consentType       ConsentType
  consentVersion    String   @default("1.0")
  
  // Consent details
  consentGiven      Boolean
  consentScope      String?  // Scope of consent
  purpose           String   @db.Text // Purpose of data processing
  legalBasis        String?  // Legal basis under PDPA
  dataCategories    String[] @default([]) // Categories of data consented to
  processingActivities String[] @default([]) // Specific processing activities
  
  // Consent management
  consentMethod     ConsentMethod // How consent was obtained
  consentContext    String?  @db.Text // Context in which consent was given
  isExplicit        Boolean  @default(false) // Whether explicit consent was required
  isInferred        Boolean  @default(false) // Whether consent was inferred
  
  // Third-party sharing
  thirdPartySharing Boolean  @default(false)
  thirdParties      String[] @default([]) // List of third parties
  dataTransferCountries String[] @default([]) // Countries for data transfer
  
  // Consent lifecycle
  consentDate       DateTime @default(now())
  expiryDate        DateTime?
  withdrawalDate    DateTime?
  isActive          Boolean  @default(true)
  lastValidated     DateTime?
  
  // Government integration
  governmentReportingRequired Boolean @default(false)
  mohReference      String?  // MOH tracking reference
  regulatoryCompliance String[] @default([]) // Applicable regulations
  
  // Audit and verification
  consentSource     String?  // Web form, mobile app, in-person, etc.
  witness           String?  // Person who witnessed consent (if applicable)
  verificationMethod String? // How consent was verified
  digitalSignature  String?  // Digital signature hash (if applicable)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user              User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([consentType])
  @@index([consentDate])
  @@index([isActive])
  @@index([expiryDate])
  @@map("consent_records")
}

// Security Events for Monitoring and Incident Response
model SecurityEvent {
  id                String   @id @default(cuid())
  eventId           String   @unique // Unique security event identifier
  eventType         SecurityEventType
  eventCategory     SecurityEventCategory
  
  // Event details
  severity          SecuritySeverity
  title             String
  description       String?  @db.Text
  details           Json     @default("{}")
  
  // Source and target
  sourceIp          String?
  sourceLocation    String?  // Geographic location
  targetResource    String?  // What was targeted
  affectedUsers     String[] @default([]) // List of affected user IDs
  affectedRecords   String[] @default([]) // List of affected record IDs
  
  // Security context
  attackVector      String?  // How the attack was attempted
  threatLevel       ThreatLevel
  attackType        String?  // SQL injection, XSS, brute force, etc.
  vulnerabilityCve  String?  // CVE number if applicable
  
  // Response and resolution
  status            SecurityEventStatus @default(OPEN)
  assignedTo        String?  // Security team member
  resolutionNotes   String?  @db.Text
  actionTaken       String?  @db.Text
  preventiveMeasures String? @db.Text
  
  // Compliance and reporting
  complianceImpact  ComplianceImpact @default(NONE)
  dataBreach        Boolean  @default(false)
  personalDataAccessed Boolean @default(false)
  regulatoryNotificationRequired Boolean @default(false)
  pdpaReportable    Boolean  @default(false) // Whether it needs to be reported under PDPA
  
  // Government and law enforcement
  lawEnforcementNotified Boolean @default(false)
  lawEnforcementReference String?
  governmentAgencyInformed String? @default("") // Which agencies were informed
  
  // Timeline
  detectedAt        DateTime @default(now())
  occurredAt        DateTime? // When the event actually occurred
  acknowledgedAt    DateTime?
  resolvedAt        DateTime?
  closedAt          DateTime?
  
  // Related audit logs
  relatedAuditLogs  String[] @default([]) // Audit log IDs related to this event
  
  // Evidence and attachments
  evidence          Json     @default("[]") // Evidence data (logs, screenshots, etc.)
  attachments       String[] @default([]) // File paths to evidence files
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  auditLogs         AuditLog[] // Relationship to audit logs

  @@index([eventType])
  @@index([severity])
  @@index([status])
  @@index([detectedAt])
  @@index([targetResource])
  @@index([pdpaReportable])
  @@map("security_events")
}

// Government System Integration Tracking
model GovernmentIntegration {
  id                String   @id @default(cuid())
  systemName        String   // e.g., "HealthHub", "NEHR", "SingPass", "MyInfo"
  systemType        GovernmentSystemType
  
  // Integration details
  apiVersion        String
  endpoint          String   // API endpoint
  integrationType   IntegrationType
  
  // Authentication and security
  authMethod        AuthMethod
  certificateThumbprint String?
  encryptionAlgorithm String? @default("AES-256")
  isTlsRequired     Boolean  @default(true)
  keyRotationSchedule String? // How often keys are rotated
  
  // Connection status
  status            IntegrationStatus
  lastHealthCheck   DateTime?
  healthCheckResults Json   @default("{}")
  uptimePercentage  Float?   @default(100.0)
  lastSuccessfulCall DateTime?
  
  // Performance metrics
  avgResponseTime   Int?     // Average response time in milliseconds
  errorRate         Float?   @default(0.0) // Error rate percentage
  totalRequests     Int      @default(0)
  successfulRequests Int     @default(0)
  failedRequests    Int      @default(0)
  
  // Rate limiting and quotas
  rateLimit         Int?     // Requests per minute
  dailyQuota        Int?     // Daily request limit
  monthlyQuota      Int?     // Monthly request limit
  currentUsage      Json     @default("{}") // Current usage tracking
  
  // Compliance and security
  complianceStandards String[] @default([]) // e.g., "PDPA", "Cybersecurity Act"
  dataClassification  GovernmentDataClassification
  auditRequired      Boolean  @default(true)
  retentionPeriod    Int?     // Days to retain integration logs
  
  // Government reporting
  reportingRequired  Boolean  @default(false)
  reportingFrequency ReportingFrequency
  lastReportDate     DateTime?
  reportRecipients   String[] @default([])
  
  // Configuration
  isActive          Boolean  @default(true)
  isProduction      Boolean  @default(false)
  environment       String   @default("development")
  testDataEnabled   Boolean  @default(false)
  
  // Monitoring and alerts
  monitoringEnabled Boolean  @default(true)
  alertThresholds   Json     @default("{}")
  escalationPolicy  String?  @db.Text
  
  // Integration logs
  integrationLogs   Json     @default("[]") // Recent integration activity logs
  errorLog          Json     @default("[]") // Error logs
  lastError         String?  @db.Text
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([systemName])
  @@index([status])
  @@index([isActive])
  @@index([environment])
  @@map("government_integrations")
}

// Compliance Reports for Regulatory Requirements
model ComplianceReport {
  id                String   @id @default(cuid())
  reportType        ComplianceReportType
  reportName        String
  reportPeriod      String   // e.g., "2024-Q1", "January-2024"
  
  // Report details
  description       String?  @db.Text
  reportVersion     String   @default("1.0")
  generatedBy       String   // User ID who generated the report
  
  // Compliance framework
  framework         String   // e.g., "PDPA", "Cybersecurity Act", "MOH Guidelines"
  frameworkVersion  String   @default("2020")
  complianceStandard String? // Specific standard being followed
  
  // Report data and metrics
  dataPeriod        Json     @default("{}") // Start and end dates
  totalRecords      Int      @default(0)
  compliantRecords  Int      @default(0)
  nonCompliantRecords Int    @default(0)
  complianceScore   Float?   @default(0.0) // Percentage compliance
  
  // Findings and issues
  findings          Json     @default("[]") // List of compliance findings
  criticalIssues    Int      @default(0)
  mediumIssues      Int      @default(0)
  lowIssues         Int      @default(0)
  recommendations   Json     @default("[]") // Recommendations for improvement
  
  // Risk assessment
  overallRiskLevel  RiskLevel
  riskFactors       String[] @default([])
  mitigationPlans   Json     @default("[]")
  
  // Government submission
  submissionRequired Boolean @default(false)
  submissionDate     DateTime?
  submissionStatus   SubmissionStatus @default(DRAFT)
  governmentAgency   String?  // Target government agency
  submissionReference String? // Government reference number
  
  // Review and approval
  reviewerId        String?
  reviewDate        DateTime?
  reviewStatus      ReviewStatus @default(PENDING)
  reviewComments    String?  @db.Text
  approvalStatus    ApprovalStatus @default(PENDING)
  approvedBy        String?
  approvedAt        DateTime?
  
  // Report files and attachments
  reportUrl         String?  // URL to the generated report
  attachments       String[] @default([]) // Supporting documents
  dataExportUrl     String?  // URL to exported data
  
  // Validation and verification
  validationChecks  Json     @default("[]") // Checks performed
  validationResults Json     @default("{}")
  verifiedBy        String?
  verifiedAt        DateTime?
  verificationMethod String? // How the report was verified
  
  // Archive and retention
  retentionPeriod   Int?     @default(2555) // Years to retain (7 years default)
  archiveDate       DateTime?
  isArchived        Boolean  @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([reportType])
  @@index([framework])
  @@index([reportPeriod])
  @@index([submissionStatus])
  @@index([reviewStatus])
  @@index([generatedBy])
  @@map("compliance_reports")
}

// Enums
enum UserRole {
  PATIENT
  ADMIN
  PROVIDER
  CLINIC_ADMIN
}

// Government Compliance Enums
enum ConsentType {
  DATA_PROCESSING
  DATA_SHARING
  MARKETING
  RESEARCH
  HEALTH_RECORD_ACCESS
  THIRD_PARTY_SHARING
  DATA_EXPORT
  LOCATION_TRACKING
  BIOMETRIC_COLLECTION
  SENSITIVE_DATA_PROCESSING
}

enum ConsentMethod {
  WEB_FORM
  MOBILE_APP
  PAPER_FORM
  VERBAL
  DIGITAL_SIGNATURE
  INFERRED
  IMPLIED
}

enum SecurityEventType {
  UNAUTHORIZED_ACCESS
  DATA_BREACH
  MALWARE_DETECTION
  PHISHING_ATTEMPT
  BRUTE_FORCE_ATTACK
  PRIVILEGE_ESCALATION
  SQL_INJECTION
  XSS_ATTEMPT
  CSRF_ATTACK
  RANSOMWARE
  Ddos_ATTACK
  INSIDER_THREAT
  DATA_EXFILTRATION
  SYSTEM_COMPROMISE
  CONFIGURATION_CHANGE
  POLICY_VIOLATION
  COMPLIANCE_VIOLATION
}

enum SecurityEventCategory {
  ACCESS_CONTROL
  DATA_PROTECTION
  NETWORK_SECURITY
  APPLICATION_SECURITY
  PHYSICAL_SECURITY
  PERSONNEL_SECURITY
  COMPLIANCE
  INCIDENT_RESPONSE
}

enum SecuritySeverity {
  CRITICAL
  HIGH
  MEDIUM
  LOW
  INFO
  NEGLIGIBLE
}

enum ThreatLevel {
  VERY_LOW
  LOW
  MEDIUM
  HIGH
  VERY_HIGH
  EXTREME
}

enum SecurityEventStatus {
  OPEN
  ACKNOWLEDGED
  INVESTIGATING
  CONTAINED
  RESOLVED
  CLOSED
  FALSE_POSITIVE
}

enum ComplianceImpact {
  NONE
  MINOR
  MODERATE
  MAJOR
  SEVERE
  CRITICAL
}

enum GovernmentSystemType {
  HEALTHHUB
  NEHR
  NDR
  SINGPASS
  MYINFO
  CHAS
  MEDISAVE
  MEDISHIELD
  MOH_SYSTEM
  NDI
  CPF
  MYSG
  CORPPASS
  IDA
  GOVTECH
}

enum IntegrationType {
  REAL_TIME
  BATCH
  WEBHOOK
  FILE_TRANSFER
  API_GATEWAY
  MESSAGE_QUEUE
}

enum AuthMethod {
  API_KEY
  OAUTH2
  JWT
  CERTIFICATE
  MUTUAL_TLS
  SAML
  WS_SECURITY
  HMAC
}

enum IntegrationStatus {
  ACTIVE
  INACTIVE
  MAINTENANCE
  ERROR
  DEGRADED
  OFFLINE
  TESTING
  DEPRECATED
}

enum GovernmentDataClassification {
  PUBLIC
  INTERNAL
  SENSITIVE
  HIGHLY_SENSITIVE
  CONFIDENTIAL
  RESTRICTED
  SECRET
  TOP_SECRET
}

enum ReportingFrequency {
  REAL_TIME
  HOURLY
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  ANNUALLY
  AS_NEEDED
  ON_DEMAND
}

enum ComplianceReportType {
  PDPA_COMPLIANCE
  SECURITY_INCIDENT
  DATA_BREACH_NOTIFICATION
  AUDIT_TRAIL
  ACCESS_LOG
  CONSENT_MANAGEMENT
  DATA_RETENTION
  THIRD_PARTY_ASSESSMENT
  VULNERABILITY_ASSESSMENT
  PENETRATION_TEST
  SECURITY_REVIEW
  COMPLIANCE_CHECK
  REGULATORY_SUBMISSION
  GOVERNMENT_REPORT
  RISK_ASSESSMENT
}

enum SubmissionStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  REQUIRES_REVISION
  ACCEPTED
  ARCHIVED
}

enum ReviewStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  APPROVED
  REJECTED
  REQUIRES_CHANGES
  EXPIRED
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  CONDITIONAL
  WITHDRAWN
  EXPIRED
  SUPERSEDED
}

enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum DoctorRole {
  ATTENDING
  VISITING
  CONSULTANT
  SPECIALIST
}

enum DoctorCapacity {
  FULL_TIME
  PART_TIME
  HOURLY
  ON_CALL
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
  EXPIRED
}

enum ConfidentialityLevel {
  STANDARD
  HIGH
  RESTRICTED
  CONFIDENTIAL
}

enum AvailabilityType {
  REGULAR
  EMERGENCY
  WALK_IN
  TELEHEALTH
  ON_CALL
  CONSULTATION
  FOLLOW_UP
}

enum AvailabilitySlotStatus {
  ACTIVE
  INACTIVE
  BLOCKED
  MAINTENANCE
  FULL
}

enum ScheduleType {
  REGULAR
  EMERGENCY
  ON_CALL
  TRAINING
  CONFERENCE
  PERSONAL
}

enum LeaveType {
  ANNUAL
  SICK
  MATERNITY
  PATERNITY
  STUDY
  EMERGENCY
  COMPASSIONATE
  UNPAID
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  COMPLETED
}

enum DoctorAppointmentStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
  RESCHEDULED
}

enum EducationType {
  MEDICAL_SCHOOL
  RESIDENCY
  FELLOWSHIP
  MASTERS
  PHD
  DIPLOMA
  CERTIFICATION
  CONTINUING_EDUCATION
}

enum MembershipType {
  PROFESSIONAL
  ACADEMIC
  RESEARCH
  GOVERNMENT
  INTERNATIONAL
  HONORARY
}

enum AwardRecognitionLevel {
  LOCAL
  NATIONAL
  INTERNATIONAL
  GLOBAL
}

enum DataSensitivity {
  PUBLIC
  STANDARD
  SENSITIVE
  HIGHLY_SENSITIVE
  MEDICAL
  CONFIDENTIAL
  RESTRICTED
}

enum ServiceComplexity {
  BASIC      // Simple procedure, minimal preparation
  MODERATE   // Standard procedure with some preparation
  COMPLEX    // Detailed preparation and follow-up required
  SPECIALIZED // Requires specialist, comprehensive process
}

enum AlternativeType {
  ALTERNATIVE  // Alternative treatment option
  COMBINATION  // Can be used together
  FOLLOW_UP    // Follow-up treatment
  PREPARATION  // Preparation for this service
  UPGRADE      // More comprehensive version
}

enum ChecklistCategory {
  PREPARATION   // Things to do before service
  DOCUMENTS     // Documents to bring
  MEDICATIONS   // Medications to manage
  LIFESTYLE     // Lifestyle changes needed
  FOLLOW_UP     // Post-service care
  WARNING       // Important warnings/considerations
}



enum UrgencyLevel {
  ROUTINE
  URGENT
  EMERGENCY
  SAME_DAY
}

enum PrerequisiteType {
  REQUIRED
  RECOMMENDED
  CONDITIONAL
  ALTERNATIVE
}

enum ServiceRelationshipType {
  COMPLEMENTARY     // Services that work well together
  ALTERNATIVE       // Alternative treatment options
  PREREQUISITE      // Must be done before
  FOLLOW_UP         // Done after this service
  EXCLUSIVE         // Cannot be done together
  CONCURRENT        // Can be done at same time
}

enum SynonymType {
  ALTERNATE_NAME    // Different name for same service
  MEDICAL_TERM      // Technical/medical terminology
  COMMON_NAME       // What patients commonly call it
  ABBREVIATION      // Common abbreviations
  LOCAL_TERM        // Singapore-specific terms
}

enum AvailabilityStatus {
  AVAILABLE
  LIMITED
  WAITLIST
  UNAVAILABLE
  MAINTENANCE
}

enum HTPriority {
  STANDARD
  HIGH
  CRITICAL
  PHASE_1
  PHASE_2
}

enum ChasTier {
  CHAS_BLUE
  CHAS_ORANGE
  CHAS_GREEN
  PIONEER
  MERDEKA
}

enum SubsidyType {
  GOVERNMENT
  HEALTHIER_SG
  SCREEN_FOR_LIFE
  MEDISAVE
  SPECIAL_PROGRAM
}

enum ChecklistPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum EquipmentType {
  GENERAL
  SPECIALIZED
  DIAGNOSTIC
  SURGICAL
  MONITORING
  LABORATORY
}

enum OutcomeType {
  DIAGNOSTIC
  THERAPEUTIC
  PREVENTIVE
  PALLIATIVE
  REHABILITATIVE
}

enum RiskLevel {
  LOW
  MODERATE
  HIGH
  CRITICAL
}

enum ClinicServiceStatus {
  ACTIVE
  INACTIVE
  MAINTENANCE
  LIMITED
  SUSPENDED
}

enum EnquiryType {
  GENERAL
  APPOINTMENT
  HEALTHIER_SG
  CLINIC_INFORMATION
  DOCTOR_INFORMATION
  SERVICE_INFORMATION
  COMPLAINT
  FEEDBACK
}

enum Priority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum EnquiryStatus {
  NEW
  IN_PROGRESS
  PENDING
  RESOLVED
  CLOSED
}

enum PackageType {
  BUNDLE          // Multiple services together
  MEMBERSHIP      // Ongoing access to services
  SEASONAL        // Time-limited offerings
  CORPORATE       // Corporate wellness packages
  FAMILY          // Family-oriented packages
  DISCOUNT        // Discount bundle
}

enum ReferralType {
  SERVICE_SPECIALIZATION // Specialized service needed
  EQUIPMENT_UNAVAILABLE  // Equipment not available
  URGENT_CARE           // Urgent care needed
  SECOND_OPINION        // Second opinion required
  FOLLOW_UP_CARE        // Follow-up care
  DIAGNOSTIC_REFERAL    // Specialized diagnostic
}

enum ReferralUrgency {
  ROUTINE
  URGENT
  SAME_DAY
  EMERGENCY
}

enum ReferralStatus {
  PENDING
  SENT
  RECEIVED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REJECTED
}

enum ReferralDocumentType {
  MEDICAL_RECORD
  LAB_RESULTS
  IMAGING_REPORTS
  PRESCRIPTION
  REFERRAL_LETTER
  INSURANCE_DOCUMENT
  CONSENT_FORM
  OTHER
}

enum DocumentAccessLevel {
  REFERRING_CLINIC     // Only referring clinic
  REFERRED_CLINIC      // Only referred clinic
  BOTH_CLINICS        // Both clinics
  PATIENT_ACCESS       // Patient can view
  RESTRICTED           // Restricted access
}

enum ExpertiseLevel {
  BASIC              // Basic service capability
  INTERMEDIATE       // Intermediate expertise
  ADVANCED           // Advanced expertise
  EXPERT             // Expert level
  PIONEER            // Pioneer in technique
}

enum CertificationType {
  PROFESSIONAL       // Professional certification
  ACADEMIC          // Academic qualification
  GOVERNMENT        // Government licensing
  SPECIALTY         // Specialty certification
  EQUIPMENT         // Equipment-specific certification
  CONTINUING_EDUCATION // Continuing education
}

enum PackageBookingStatus {
  ACTIVE            // Package is currently active
  EXPIRED           // Package has expired
  EXHAUSTED         // All sessions used
  CANCELLED         // Package was cancelled
  SUSPENDED         // Package temporarily suspended
}

enum PartnershipType {
  REFERRED          // Basic referral relationship
  PREFERRED         // Preferred partner with priority
  EXCLUSIVE         // Exclusive partnership
  COLLABORATIVE     // Collaborative care arrangement
}

enum PartnershipPriority {
  HIGH
  MEDIUM
  LOW
}

enum CollaborationType {
  SHARED_PATIENT_CARE
  CROSS_CONSULTATION
  EMERGENCY_COVERAGE
  SPECIALIZED_SERVICES
  RESEARCH
  TRAINING
  QUALITY_IMPROVEMENT
}

// Healthier SG Program Enums
enum HealthierSGCategory {
  PREVENTIVE_CARE
  CHRONIC_DISEASE_MANAGEMENT
  HEALTH_SCREENING
  LIFESTYLE_INTERVENTION
  MENTAL_HEALTH
  MATERNAL_CHILD_HEALTH
  ELDERLY_CARE
  REHABILITATION
  HEALTH_EDUCATION
  COMMUNITY_HEALTH
}

enum HealthierSGReportingFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  ANNUALLY
  AS_NEEDED
}

enum HealthierSGEnrollmentMethod {
  ONLINE_SELF_ENROLLMENT
  CLINIC_ASSISTED
  REFERRAL
  GOVERNMENT_INITIATED
  MOBILE_APP
  PHONE_CALL
  WALK_IN
  HOME_VISIT
}

enum HealthierSGEnrollmentStatus {
  ACTIVE
  SUSPENDED
  COMPLETED
  WITHDRAWN
  EXPIRED
  PENDING_VERIFICATION
  REJECTED
  TRANSFERRED
}

enum HealthierSGEligibilityRuleType {
  AGE_BASED
  MEDICAL_CONDITION
  GEOGRAPHIC
  SOCIOECONOMIC
  BEHAVIORAL
  DEMOGRAPHIC
  LIFESTYLE
  RISK_ASSESSMENT
  COMBINATION
  DYNAMIC
}

enum HealthierSGRecalculationFrequency {
  REAL_TIME
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  ANNUALLY
  EVENT_TRIGGERED
}

enum HealthierSGEvaluationType {
  INITIAL
  PERIODIC
  TRIGGERED
  RE_EVALUATION
  APPEAL
  COMPLIANCE
  QUALITY_ASSURANCE
}

enum HealthierSGEvaluationResult {
  ELIGIBLE
  NOT_ELIGIBLE
  CONDITIONAL
  PENDING_DOCUMENTATION
  REQUIRES_REVIEW
  APPEAL_REQUIRED
}

enum HealthierSGBenefitType {
  MONETARY
  SERVICE_DISCOUNT
  SUBSIDY
  REIMBURSEMENT
  PREVENTIVE_SCREENING
  HEALTHCARE_SERVICE
  MEDICATION
  EQUIPMENT
  EDUCATION
  SUPPORT_SERVICE
}

enum HealthierSGBenefitStatus {
  ACTIVE
  SUSPENDED
  EXPIRED
  EXHAUSTED
  PENDING_ACTIVATION
  UNDER_REVIEW
  DISPUTED
}

enum HealthierSGBenefitPaymentMechanism {
  DIRECT_PAYMENT
  REIMBURSEMENT
  CLAIM_SUBMISSION
  AUTOMATIC_CREDIT
  VOUCHER_SYSTEM
  INSURANCE_CLAIM
}

enum HealthierSGClaimStatus {
  PENDING
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  PARTIALLY_APPROVED
  PAID
  DISPUTED
  APPEALED
}

enum HealthierSGClaimSubmissionMethod {
  ONLINE_PORTAL
  MOBILE_APP
  EMAIL
  MAIL
  IN_PERSON
  PHONE
  API_INTEGRATION
  BATCH_SUBMISSION
}

enum HealthierSGClinicParticipationType {
  FULL_PARTICIPATION
  SELECTED_SERVICES
  PILOT_PROGRAM
  RESEARCH_PARTICIPANT
  TRAINING_CENTER
  REFERRAL_PARTNER
  COLLABORATIVE_CARE
}

enum HealthierSGClinicStatus {
  PENDING
  APPROVED
  ACCREDITED
  SUSPENDED
  REVOKED
  EXPIRED
  UNDER_REVIEW
  CONDITIONAL_APPROVAL
}

enum HealthierSGClinicAccreditation {
  BASIC
  STANDARD
  ADVANCED
  SPECIALIZED
  CENTER_OF_EXCELLENCE
  RESEARCH_CENTER
  TRAINING_CENTER
}

enum HealthierSGMetricPeriod {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  ANNUALLY
  CAMPAIGN_PERIOD
  PROGRAM_PHASE
}

enum HealthierSGSmokingStatus {
  NEVER_SMOKED
  FORMER_SMOKER
  CURRENT_SMOKER
  OCCASIONAL_SMOKER
  SECONDHAND_EXPOSURE
  QUIT_RECENTLY
  QUIT_LONG_TERM
}

enum HealthierSGExerciseFrequency {
  NEVER
  RARELY
  WEEKLY_1_2_TIMES
  WEEKLY_3_4_TIMES
  DAILY
  MULTIPLE_TIMES_DAILY
  SEDENTARY
  MODERATE
  HIGHLY_ACTIVE
}

enum HealthierSGStressLevel {
  VERY_LOW
  LOW
  MODERATE
  HIGH
  VERY_HIGH
  EXTREME
  MANAGED
  UNMANAGED
}

enum HealthierSGAssessmentType {
  INITIAL_HEALTH_ASSESSMENT
  PERIODIC_HEALTH_REVIEW
  RISK_ASSESSMENT
  BEHAVIORAL_ASSESSMENT
  NUTRITIONAL_ASSESSMENT
  MENTAL_HEALTH_ASSESSMENT
  FUNCTIONAL_ASSESSMENT
  QUALITY_OF_LIFE_ASSESSMENT
  PROGRAM_READINESS
  GOAL_SETTING_SESSION
}

enum HealthierSGRiskLevel {
  VERY_LOW
  LOW
  MODERATE
  HIGH
  VERY_HIGH
  CRITICAL
  EMERGING
  MANAGED
}

enum HealthierSGActivityType {
  HEALTH_SCREENING
  CONSULTATION
  EDUCATIONAL_SESSION
  EXERCISE_CLASS
  NUTRITION_COUNSELING
  BEHAVIORAL_COUNSELING
  MEDICATION_REVIEW
  FOLLOW_UP_VISIT
  GROUP_SESSION
  HOME_BASED_ACTIVITY
  TELEHEALTH_SESSION
  MONITORING_CHECK
}

enum HealthierSGActivityStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  MISSED
  CANCELLED
  RESCHEDULED
  REQUIRES_FOLLOW_UP
  PENDING_DOCUMENTATION
}

enum HealthierSGMilestoneType {
  ENROLLMENT_COMPLETE
  ASSESSMENT_COMPLETE
  FIRST_CONSULTATION
  INTERIM_MILESTONE
  HEALTH_GOAL_ACHIEVED
  PROGRAM_COMPLETION
  BEHAVIOR_CHANGE
  HEALTH_IMPROVEMENT
  KNOWLEDGE_ACHIEVEMENT
  PARTICIPATION_TARGET
}

enum HealthierSGOutcomeType {
  HEALTH_IMPROVEMENT
  BEHAVIOR_CHANGE
  RISK_REDUCTION
  QUALITY_OF_LIFE
  COST_EFFECTIVENESS
  PATIENT_SATISFACTION
  ADHERENCE_RATE
  PREVENTION_SUCCESS
  EARLY_DETECTION
  PROGRAM_ENGAGEMENT
}

enum HealthierSGGoalType {
  WEIGHT_MANAGEMENT
  BLOOD_PRESSURE_CONTROL
  DIABETES_MANAGEMENT
  CHOLESTEROL_MANAGEMENT
  SMOKING_CESSATION
  PHYSICAL_ACTIVITY
  NUTRITION_IMPROVEMENT
  STRESS_MANAGEMENT
  MEDICATION_ADHERENCE
  PREVENTIVE_SCREENING
  MENTAL_HEALTH
  FUNCTIONAL_IMPROVEMENT
  QUALITY_OF_LIFE
  DISEASE_MANAGEMENT
}

enum HealthierSGGoalPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
  URGENT
  OPTIONAL
  MANDATORY
}

enum HealthierSGGoalStatus {
  ACTIVE
  ON_TRACK
  BEHIND_SCHEDULE
  ACHIEVED
  MODIFIED
  CANCELLED
  ON_HOLD
  ARCHIVED
}

enum HealthierSGMotivationLevel {
  VERY_LOW
  LOW
  MODERATE
  HIGH
  VERY_HIGH
  EXTREMELY_HIGH
  FLUCTUATING
  DECLINING
}

enum HealthierSGDifficultyLevel {
  VERY_EASY
  EASY
  MODERATE
  DIFFICULT
  VERY_DIFFICULT
  EXTREMELY_CHALLENGING
  MANAGEABLE
}

enum HealthierSGSatisfactionLevel {
  VERY_DISSATISFIED
  DISSATISFIED
  NEUTRAL
  SATISFIED
  VERY_SATISFIED
  EXTREMELY_SATISFIED
  MIXED_FEELINGS
}

enum HealthierSGAuditAction {
  CREATE
  READ
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  ACCESS_DENIED
  DATA_EXPORT
  DATA_IMPORT
  SYSTEM_ACCESS
  CONFIGURATION_CHANGE
  BACKUP
  RESTORE
}

enum HealthierSGAuditDataSensitivity {
  PUBLIC
  INTERNAL
  SENSITIVE
  HIGHLY_SENSITIVE
  CONFIDENTIAL
  RESTRICTED
  MEDICAL
  PERSONAL_IDENTIFIABLE
}

enum HealthierSGAuditRiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
  EMERGENCY
  MONITORING
}

enum HealthierSGAuditType {
  REGULAR_SCHEDULED
  COMPLIANCE_AUDIT
  DATA_QUALITY_AUDIT
  SECURITY_AUDIT
  PERFORMANCE_AUDIT
  FINANCIAL_AUDIT
  PROGRAM_EFFECTIVENESS
  INCIDENT_RESPONSE
  SPOT_CHECK
  EXTERNAL_AUDIT
}

enum HealthierSGAuditPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
  URGENT
  ROUTINE
}

enum HealthierSGDocumentType {
  IDENTITY_VERIFICATION
  MEDICAL_RECORDS
  CONSENT_FORMS
  ELIGIBILITY_DOCUMENTS
  BENEFIT_CLAIMS
  INVOICES_RECEIPTS
  INSURANCE_DOCUMENTS
  REFERRAL_LETTERS
  DISCHARGE_SUMMARIES
  LAB_RESULTS
  IMAGING_REPORTS
  PRESCRIPTION_RECORDS
  PROGRAM_CERTIFICATES
  AUDIT_REPORTS
  COMPLIANCE_DOCUMENTS
}

enum HealthierSGDocumentVerificationStatus {
  PENDING
  UNDER_REVIEW
  VERIFIED
  REJECTED
  EXPIRED
  REQUIRES_RENEWAL
  CONDITIONALLY_APPROVED
}

enum HealthierSGDocumentAccessLevel {
  PUBLIC
  RESTRICTED
  CONFIDENTIAL
  HIGHLY_CONFIDENTIAL
  MEDICAL_RECORD
  AUDIT_ONLY
  GOVERNMENT_ONLY
  TIME_LIMITED
}

// Partnership and Collaboration Models
model ClinicPartnership {
  id                String            @id @default(cuid())
  primaryClinicId   String
  partnerClinicId   String
  
  // Partnership details
  partnershipType   PartnershipType   @default(REFERRED)
  priority          PartnershipPriority @default(MEDIUM)
  specialty         String?           // Specific specialty focus
  specialties       String[]          @default([]) // Multiple specialties
  isActive          Boolean           @default(true)
  
  // Terms and conditions
  terms             Json              @default("{}") // Partnership terms
  referralFeePercentage Float?        // Referral fee percentage
  minimumReferrals  Int?              // Minimum referral requirements
  maximumReferrals  Int?              // Maximum referral limits
  collaborationRequirements String[]  @default([]) // Requirements
  
  // Effective dates
  effectiveFrom     DateTime          @default(now())
  effectiveTo       DateTime?
  
  // Status and notes
  status            PartnershipPriority @default(MEDIUM)
  notes             String?           @db.Text
  
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  primaryClinic     Clinic            @relation("PrimaryClinic", fields: [primaryClinicId], references: [id], onDelete: Cascade)
  partnerClinic     Clinic            @relation("PartnerClinic", fields: [partnerClinicId], references: [id], onDelete: Cascade)
  collaborationMetrics PartnershipMetrics[]
  referralMetrics   ReferralMetrics[]

  @@unique([primaryClinicId, partnerClinicId])
  @@index([primaryClinicId])
  @@index([partnerClinicId])
  @@index([partnershipType])
  @@index([isActive])
  @@map("clinic_partnerships")
}

model ClinicCollaboration {
  id                String            @id @default(cuid())
  primaryClinicId   String
  partnerClinicId   String
  
  // Collaboration details
  collaborationType CollaborationType @default(SHARED_PATIENT_CARE)
  sharedServices    String[]          @default([])
  
  // Patient care protocol
  patientCareProtocol Json            @default("{}")
  
  // Quality metrics
  qualityMetrics     Json             @default("{}")
  
  // Status
  isActive          Boolean           @default(true)
  notes             String?           @db.Text
  
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  primaryClinic     Clinic            @relation("PrimaryCollabClinic", fields: [primaryClinicId], references: [id], onDelete: Cascade)
  partnerClinic     Clinic            @relation("PartnerCollabClinic", fields: [partnerClinicId], references: [id], onDelete: Cascade)
  collaborationMetrics CollaborationMetrics[]

  @@unique([primaryClinicId, partnerClinicId, collaborationType])
  @@index([primaryClinicId])
  @@index([partnerClinicId])
  @@index([collaborationType])
  @@index([isActive])
  @@map("clinic_collaborations")
}

model PartnershipMetrics {
  id                String    @id @default(cuid())
  partnershipId     String
  date              DateTime  @default(now())
  
  // Performance metrics
  referralCount     Int       @default(0)
  collaborationScore Float    @default(0) // 0-100
  patientSatisfaction Float   @default(0) // 1-5 scale
  responseTime      Float     @default(0) // hours
  
  // Additional metrics
  successfulReferrals Int     @default(0)
  averageWaitTime   Float     @default(0) // days
  costSavings       Float     @default(0) // SGD
  
  // Status
  isActive          Boolean   @default(true)
  
  createdAt         DateTime  @default(now())

  partnership       ClinicPartnership @relation(fields: [partnershipId], references: [id], onDelete: Cascade)

  @@unique([partnershipId, date])
  @@index([partnershipId])
  @@index([date])
  @@map("partnership_metrics")
}

model CollaborationMetrics {
  id                String    @id @default(cuid())
  collaborationId   String
  date              DateTime  @default(now())
  
  // Collaboration metrics
  sharedPatientsCount Int     @default(0)
  crossConsultations  Int     @default(0)
  emergencyCoverages  Int     @default(0)
  
  // Quality metrics
  patientOutcomes   Float     @default(0) // Success rate 0-100
  responseTime      Float     @default(0) // hours
  satisfactionScore Float     @default(0) // 1-5 scale
  
  // Communication metrics
  responseRate      Float     @default(0) // percentage
  documentationQuality Float   @default(0) // 1-5 scale
  
  createdAt         DateTime  @default(now())

  collaboration     ClinicCollaboration @relation(fields: [collaborationId], references: [id], onDelete: Cascade)

  @@unique([collaborationId, date])
  @@index([collaborationId])
  @@index([date])
  @@map("collaboration_metrics")
}

model ReferralMetrics {
  id                String    @id @default(cuid())
  partnershipId     String
  date              DateTime  @default(now())
  
  // Referral statistics
  totalReferrals    Int       @default(0)
  completedReferrals Int      @default(0)
  pendingReferrals  Int       @default(0)
  
  // Quality metrics
  successRate       Float     @default(0) // percentage
  patientSatisfaction Float   @default(0) // 1-5 scale
  averageResponseTime Float   @default(0) // hours
  
  // Revenue metrics
  referralRevenue   Float     @default(0) // SGD
  costSavings       Float     @default(0) // SGD
  
  createdAt         DateTime  @default(now())

  partnership       ClinicPartnership @relation(fields: [partnershipId], references: [id], onDelete: Cascade)

  @@unique([partnershipId, date])
  @@index([partnershipId])
  @@index([date])
  @@map("referral_metrics")
}

// Benefits and Incentives Tracking Models
model UserBenefits {
  id                String   @id @default(cuid())
  userId            String   @unique
  
  // Benefits calculation
  benefitsTier      BenefitsTier @default(BASIC)
  totalEarned       Float   @default(0) // Total benefits earned in SGD
  totalUsed         Float   @default(0) // Total benefits used in SGD
  currentBalance    Float   @default(0) // Current benefits balance
  monthlyCap        Float   @default(500) // Monthly benefits cap
  annualCap         Float   @default(2000) // Annual benefits cap
  
  // Healthier SG integration
  isHealthierSGMember Boolean @default(false)
  healthierSGLevel   HealthierSGProgramTier?
  
  // Medisave integration
  medisaveAccount    String? // Medisave account number
  medisaveBalance    Float   @default(0)
  autoDeductEnabled  Boolean @default(false)
  
  // CHAS integration
  chasCardNumber     String?
  chasTier           ChasTier?
  chasBalance        Float   @default(0)
  
  // MediShield Life
  mediShieldPolicy   String?
  mediShieldActive   Boolean @default(false)
  
  // Eligibility and status
  eligibilityStatus  BenefitsEligibilityStatus @default(ACTIVE)
  eligibilityUpdated DateTime @default(now())
  complianceVerified Boolean @default(false)
  lastVerification   DateTime?
  
  // Government integration
  mohVerified        Boolean @default(false)
  governmentId       String? // Government tracking ID
  syncStatus         BenefitsSyncStatus @default(PENDING)
  lastSyncAt         DateTime?
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  user               User @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions       BenefitTransaction[]
  claims             BenefitClaim[]
  screenings         HealthScreening[]
  incentives         IncentiveEarned[]
  complianceRecords  BenefitComplianceRecord[]

  @@index([userId])
  @@index([benefitsTier])
  @@index([eligibilityStatus])
  @@map("user_benefits")
}

model BenefitTier {
  id                String   @id @default(cuid())
  name              String   @unique
  displayName       String
  description       String?  @db.Text
  
  // Tier requirements
  minAge            Int?
  maxAge            Int?
  chronicConditions String[] @default([])
  incomeThreshold   Float?
  
  // Benefits structure
  baseBenefits      Float    @default(0)
  healthScreening   Float    @default(0)
  chronicCare       Float    @default(0)
  preventiveCare    Float    @default(0)
  medicationSubsidy Float    @default(0)
  
  // Usage limits
  monthlyVisitLimit Int?
  annualVisitLimit  Int?
  screeningFrequency String? // e.g., "annual", "biannual"
  
  // Government integration
  mohProgramId      String?
  mohApprovalRequired Boolean @default(false)
  
  // Status and metadata
  isActive          Boolean  @default(true)
  effectiveFrom     DateTime @default(now())
  effectiveTo       DateTime?
  priority          Int      @default(0)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([isActive])
  @@index([priority])
  @@map("benefit_tiers")
}

model BenefitTransaction {
  id                String   @id @default(cuid())
  userBenefitsId    String
  
  // Transaction details
  transactionType   BenefitTransactionType
  amount            Float    // Positive for credits, negative for debits
  description       String
  referenceNumber   String   @unique // Unique transaction reference
  
  // Service information
  serviceId         String?
  clinicId          String?
  healthScreeningId String?
  
  // Payment integration
  paymentMethod     BenefitPaymentMethod?
  medisaveUsed      Float?   @default(0)
  cashUsed          Float?   @default(0)
  chasUsed          Float?   @default(0)
  
  // Benefits calculation
  preTaxAmount      Float
  subsidyAmount     Float
  finalAmount       Float
  taxDeductible     Boolean  @default(false)
  deductibleAmount  Float?   @default(0)
  
  // Status tracking
  status            BenefitTransactionStatus @default(PENDING)
  processedAt       DateTime?
  verifiedAt        DateTime?
  
  // Government integration
  mohReportingRequired Boolean @default(false)
  mohReferenceId     String?
  complianceChecked  Boolean @default(false)
  
  // Audit trail
  createdBy         String?  // User ID or system
  approvalRequired  Boolean  @default(false)
  approvedBy        String?
  approvedAt        DateTime?
  rejectionReason   String?  @db.Text
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  userBenefits      UserBenefits @relation(fields: [userBenefitsId], references: [id], onDelete: Cascade)
  healthScreening   HealthScreening? @relation(fields: [healthScreeningId], references: [id], onDelete: SetNull)
  
  @@index([userBenefitsId])
  @@index([transactionType])
  @@index([status])
  @@index([createdAt])
  @@map("benefit_transactions")
}

model HealthScreening {
  id                String   @id @default(cuid())
  userBenefitsId    String
  
  // Screening details
  screeningType     HealthScreeningType
  screeningName     String
  description       String?  @db.Text
  
  // Schedule information
  scheduledDate     DateTime
  completedDate     DateTime?
  dueDate           DateTime
  
  // Provider information
  clinicId          String
  doctorId          String?
  technicianId      String?
  
  // Cost and payment
  totalCost         Float
  subsidizedAmount  Float
  patientPays       Float
  
  // Benefits used
  benefitsUsed      Float    @default(0)
  medisaveUsed      Float?   @default(0)
  chasUsed          Float?   @default(0)
  cashPaid          Float    @default(0)
  
  // Results and follow-up
  resultsAvailable  Boolean  @default(false)
  resultsDate       DateTime?
  resultsSummary    String?  @db.Text
  followUpRequired  Boolean  @default(false)
  followUpDate      DateTime?
  followUpNotes     String?  @db.Text
  
  // Status tracking
  status            HealthScreeningStatus @default(SCHEDULED)
  completionPercentage Float? @default(0)
  
  // Government integration
  mohTrackingId     String?
  complianceRequired Boolean @default(true)
  complianceStatus  ScreeningComplianceStatus?
  
  // Benefits calculation
  eligibleForBenefits Boolean @default(true)
  benefitsCalculated  Boolean @default(false)
  benefitsAmount      Float?   @default(0)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  userBenefits      UserBenefits @relation(fields: [userBenefitsId], references: [id], onDelete: Cascade)
  transactions      BenefitTransaction[]
  
  @@index([userBenefitsId])
  @@index([screeningType])
  @@index([status])
  @@index([scheduledDate])
  @@map("health_screenings")
}

model IncentiveEarned {
  id                String   @id @default(cuid())
  userBenefitsId    String
  
  // Incentive details
  incentiveType     IncentiveType
  incentiveName     String
  description       String?  @db.Text
  
  // Earning criteria
  milestoneType     String?  // e.g., "goal_achieved", "screening_completed"
  milestoneValue    String?  // JSON or string value
  criteriaMet       Boolean  @default(false)
  
  // Reward information
  rewardType        IncentiveRewardType
  rewardValue       Float    // Monetary value in SGD
  rewardPoints      Int?     // Points (if using point system)
  rewardDescription String?  @db.Text
  
  // Achievement tracking
  earnedDate        DateTime @default(now())
  milestoneDate     DateTime?
  verificationRequired Boolean @default(false)
  verifiedBy        String?  // User ID who verified
  verifiedAt        DateTime?
  verificationNotes String?  @db.Text
  
  // Benefits impact
  addedToBalance    Boolean  @default(false)
  balanceAdded      Float?   @default(0)
  expiresAt         DateTime?
  usageRules        String?  @db.Text // JSON string of usage rules
  
  // Integration points
  goalId            String?  // Related health goal
  activityId        String?  // Related health activity
  programMilestoneId String? // Related program milestone
  
  // Government reporting
  reportToGovernment Boolean @default(true)
  mohReference      String?
  complianceCode    String?  // Government compliance code
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  userBenefits      UserBenefits @relation(fields: [userBenefitsId], references: [id], onDelete: Cascade)
  
  @@index([userBenefitsId])
  @@index([incentiveType])
  @@index([earnedDate])
  @@index([expiresAt])
  @@map("incentives_earned")
}

model BenefitClaim {
  id                String   @id @default(cuid())
  userBenefitsId    String
  
  // Claim details
  claimType         BenefitClaimType
  claimTitle        String
  description       String?  @db.Text
  
  // Amounts and services
  claimAmount       Float
  approvedAmount    Float?
  serviceDate       DateTime
  serviceDetails    String?  @db.Text
  
  // Documentation
  receiptUrl        String?
  receiptFileName   String?
  additionalDocs    String[] @default([])
  claimReference    String?  @unique
  
  // Processing status
  status            BenefitClaimStatus @default(SUBMITTED)
  submittedAt       DateTime @default(now())
  reviewedAt        DateTime?
  approvedAt        DateTime?
  processedAt       DateTime?
  
  // Approval workflow
  reviewerId        String?
  reviewerNotes     String?  @db.Text
  rejectionReason   String?  @db.Text
  resubmissionRequired Boolean @default(false)
  
  // Payment integration
  paymentMethod     ClaimPaymentMethod?
  paymentReference  String?
  paymentDate       DateTime?
  paymentStatus     ClaimPaymentStatus?
  
  // Government integration
  mohSubmitted      Boolean  @default(false)
  mohReference      String?
  governmentApproval Boolean @default(false)
  complianceChecked Boolean  @default(false)
  
  // Audit trail
  submittedBy       String   @default("user")
  approvalWorkflow  Json     @default("[]") // Approval steps tracking
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  userBenefits      UserBenefits @relation(fields: [userBenefitsId], references: [id], onDelete: Cascade)
  
  @@index([userBenefitsId])
  @@index([claimType])
  @@index([status])
  @@index([submittedAt])
  @@map("benefit_claims")
}

model BenefitComplianceRecord {
  id                String   @id @default(cuid())
  userBenefitsId    String
  
  // Compliance details
  complianceType    BenefitComplianceType
  checkDate         DateTime @default(now())
  complianceStatus  BenefitComplianceStatus
  
  // Check results
  criteriaChecked   Json     @default("[]") // Array of criteria
  passedCriteria    Json     @default("[]") // Passed criteria
  failedCriteria    Json     @default("[]") // Failed criteria
  
  // Risk assessment
  riskLevel         BenefitRiskLevel @default(LOW)
  riskFactors       String[] @default([])
  mitigationActions Json     @default("[]")
  
  // Government reporting
  reportRequired    Boolean  @default(false)
  reportedAt        DateTime?
  mohReference      String?
  governmentNotes   String?  @db.Text
  
  // Resolution tracking
  issuesFound       Json     @default("[]")
  resolutionActions Json     @default("[]")
  resolvedBy        String?
  resolvedAt        DateTime?
  followUpRequired  Boolean  @default(false)
  followUpDate      DateTime?
  
  // Audit information
  checkedBy         String?  // System or user ID
  verificationMethod String? // How compliance was verified
  evidence          Json     @default("[]") // Supporting evidence
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  userBenefits      UserBenefits @relation(fields: [userBenefitsId], references: [id], onDelete: Cascade)
  
  @@index([userBenefitsId])
  @@index([complianceType])
  @@index([complianceStatus])
  @@index([checkDate])
  @@map("benefit_compliance_records")
}

// Enums for Benefits and Incentives
enum BenefitsTier {
  BASIC
  ENHANCED
  PREMIUM
}

enum HealthierSGProgramTier {
  STANDARD
  PRIORITY
  PREMIUM
  CHRONIC_CARE
}

enum BenefitsEligibilityStatus {
  ACTIVE
  SUSPENDED
  EXPIRED
  UNDER_REVIEW
  PENDING_VERIFICATION
}

enum BenefitsSyncStatus {
  PENDING
  IN_PROGRESS
  SYNCED
  FAILED
  MANUAL_REVIEW
}

enum BenefitTransactionType {
  CREDIT_EARNED
  CREDIT_USED
  SUBSIDY_APPLIED
  MEDISAVE_DEDUCT
  CHAS_DEDUCT
  CASH_PAYMENT
  REFUND
  ADJUSTMENT
  GOVERNMENT_SUBSIDY
  CLINIC_DISCOUNT
}

enum BenefitPaymentMethod {
  MEDISAVE
  MEDISHIELD
  CHAS
  CASH
  CREDIT_CARD
  BANK_TRANSFER
  GOVERNMENT_SUBSIDY
}

enum BenefitTransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
  DISPUTED
}

enum HealthScreeningType {
  ANNUAL_CHECKUP
  DIABETES_SCREENING
  CHOLESTEROL_SCREENING
  BLOOD_PRESSURE_CHECK
  CANCER_SCREENING
  HEART_HEALTH
  KIDNEY_FUNCTION
  LIVER_FUNCTION
  THYROID_FUNCTION
  EYE_EXAM
  DENTAL_CHECKUP
  VACCINATION
  CHRONIC_DISEASE_MONITORING
  LIFESTYLE_ASSESSMENT
  NUTRITIONAL_ASSESSMENT
  MENTAL_HEALTH_SCREENING
}

enum HealthScreeningStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
  REQUIRES_FOLLOW_UP
  RESULTS_PENDING
  RESULTS_AVAILABLE
}

enum ScreeningComplianceStatus {
  COMPLIANT
  NON_COMPLIANT
  PENDING_REVIEW
  REQUIRES_ACTION
  EXEMPTED
}

enum IncentiveType {
  HEALTH_SCREENING_COMPLETION
  GOAL_ACHIEVEMENT
  MILESTONE_REACHED
  PARTICIPATION_STREAK
  HEALTH_EDUCATION_COMPLETION
  LIFESTYLE_IMPROVEMENT
  MEDICATION_ADHERENCE
  APPOINTMENT_ATTENDANCE
  COMMUNITY_ENGAGEMENT
  REFERRAL_REWARD
  WEARABLE_INTEGRATION
  QUALITY_SCORE
  COMPLIANCE_REWARD
  SPECIAL_PROGRAM
  SEASONAL_CAMPAIGN
}

enum IncentiveRewardType {
  MONETARY
  POINTS
  DISCOUNT
  SUBSIDY
  EXTRA_BENEFITS
  PRIORITY_ACCESS
  SERVICE_UPGRADE
  HEALTHCARE_CREDIT
}

enum BenefitClaimType {
  SCREENING_COST
  TREATMENT_COST
  MEDICATION_COST
  CONSULTATION_FEE
  DIAGNOSTIC_TEST
  THERAPY_SESSION
  PREVENTIVE_CARE
  CHRONIC_CARE_MANAGEMENT
  EMERGENCY_CARE
  SPECIALIZED_CARE
  REHABILITATION
  HOME_CARE
  EQUIPMENT
  TRANSPORT
  OTHER
}

enum BenefitClaimStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  PARTIALLY_APPROVED
  REJECTED
  ADDITIONAL_INFO_REQUIRED
  PROCESSING
  PAID
  DISPUTED
  WITHDRAWN
}

enum ClaimPaymentMethod {
  MEDISAVE
  MEDISHIELD_LIFE
  CHAS
  GOVERNMENT_SUBSIDY
  DIRECT_DEPOSIT
  CHEQUE
  CREDIT_TRANSFER
}

enum ClaimPaymentStatus {
  PENDING
  PROCESSING
  PAID
  FAILED
  DISPUTED
  CANCELLED
}

enum BenefitComplianceType {
  ELIGIBILITY_VERIFICATION
  BENEFIT_UTILIZATION
  DOCUMENTATION_COMPLIANCE
  GOVERNMENT_REPORTING
  FRAUD_PREVENTION
  AUDIT_COMPLIANCE
  REGULATORY_COMPLIANCE
  QUALITY_ASSURANCE
}

enum BenefitComplianceStatus {
  COMPLIANT
  NON_COMPLIANT
  PARTIALLY_COMPLIANT
  PENDING_REVIEW
  UNDER_INVESTIGATION
  ACTION_REQUIRED
  EXEMPTED
}

enum BenefitRiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
  EMERGENCY
}

// Database extension for PostGIS
// This will be handled by Supabase backend, but we include it for schema completeness
model PostGISSetup {
  id              String @id @default(cuid())
  extension       String @default("postgis")
  isEnabled       Boolean @default(true)
  version         String @default("3.3.0")
  createdAt       DateTime @default(now())
}

// ========================================
// INTEGRATION MODELS (Sub-Phase 8.10)
// Healthier SG Program Integration with Phase 1-7 Features
// ========================================

model IntegrationAuditLog {
  id                String   @id @default(cuid())
  sourceSystem      String   // 'healthier_sg', 'clinic', 'doctor', 'service', 'user'
  targetSystem      String   // 'healthier_sg', 'clinic', 'doctor', 'service', 'user'
  operationType     String   // 'CREATE', 'UPDATE', 'DELETE', 'SYNC', 'VALIDATE'
  entityType        String   // 'Clinic', 'Doctor', 'Service', 'User', 'Appointment'
  entityId          String
  operationData     Json
  beforeState       Json?
  afterState        Json?
  syncStatus        IntegrationSyncStatus @default(PENDING)
  errorMessage      String?
  retryCount        Int      @default(0)
  maxRetries        Int      @default(3)
  processingTime    Int?     // in milliseconds
  dataSize          Int?     // bytes
  userId            String?
  sessionId         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([sourceSystem, targetSystem])
  @@index([operationType, entityType])
  @@index([syncStatus, createdAt])
  @@index([entityType, entityId])
  @@map("integration_audit_logs")
}

model IntegrationDataSync {
  id                String   @id @default(cuid())
  syncType          IntegrationSyncType
  sourceEntity      String   // 'clinic', 'doctor', 'service', 'user'
  targetEntity      String   // 'clinic', 'doctor', 'service', 'user'
  sourceId          String
  targetId          String
  syncStatus        IntegrationSyncStatus @default(PENDING)
  lastSyncAt        DateTime?
  syncMetadata      Json
  conflictResolution Json?
  dataValidation    Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([syncType, syncStatus])
  @@index([sourceEntity, sourceId])
  @@index([targetEntity, targetId])
  @@index([lastSyncAt])
  @@map("integration_data_syncs")
}

model IntegrationRelationship {
  id                String   @id @default(cuid())
  system1           String   // 'healthier_sg', 'clinic', 'doctor', 'service', 'user'
  system2           String   // 'healthier_sg', 'clinic', 'doctor', 'service', 'user'
  entity1Type       String
  entity2Type       String
  entity1Id         String
  entity2Id         String
  relationshipType  String   // 'participates_in', 'covers', 'certified_for', 'enrolled_in', etc.
  relationshipData  Json
  isActive          Boolean  @default(true)
  validFrom         DateTime @default(now())
  validTo           DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@unique([system1, system2, entity1Type, entity2Type, entity1Id, entity2Id, relationshipType])
  @@index([system1, system2])
  @@index([relationshipType, isActive])
  @@index([validFrom, validTo])
  @@map("integration_relationships")
}

model CrossSystemSearchLog {
  id                String   @id @default(cuid())
  searchQuery       String
  searchFilters     Json
  sourceSystem      String   // Where search originated
  targetSystems     String[] // Systems searched across
  resultsCount      Int
  responseTime      Int      // milliseconds
  sessionId         String?
  userId            String?
  searchContext     Json     // Current page, user context, etc.
  clickedResults    Json?    // What user clicked after search
  conversionMetrics Json?    // Did search lead to action
  createdAt         DateTime @default(now())

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([searchQuery, createdAt])
  @@index([sourceSystem, createdAt])
  @@index([sessionId, createdAt])
  @@index([userId, createdAt])
  @@map("cross_system_search_logs")
}

model IntegrationMetrics {
  id                    String   @id @default(cuid())
  metricType            IntegrationMetricType
  sourceSystem          String
  targetSystem          String
  entityType            String
  entityId              String
  metricValue           Float
  metricUnit            String   // 'count', 'percentage', 'time', 'bytes'
  measurementContext    Json
  period                String   // 'daily', 'weekly', 'monthly', 'realtime'
  recordedAt            DateTime @default(now())

  @@index([metricType, recordedAt])
  @@index([sourceSystem, targetSystem])
  @@index([entityType, entityId])
  @@index([period, recordedAt])
  @@map("integration_metrics")
}

model IntegrationPreferences {
  id                        String   @id @default(cuid())
  userId                    String?
  system                    String   // 'healthier_sg', 'clinic', 'doctor', 'service', 'user'
  entityType                String?
  entityId                  String?
  integrationType           IntegrationType
  preferences               Json     // JSON object with specific preferences
  isEnabled                 Boolean  @default(true)
  priority                  Int      @default(1) // Lower number = higher priority
  notificationSettings      Json
  syncFrequency             IntegrationSyncFrequency @default(MANUAL)
  lastSyncAt                DateTime?
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, system, entityType, entityId, integrationType])
  @@index([userId, system])
  @@index([integrationType, isEnabled])
  @@map("integration_preferences")
}

model IntegrationCache {
  id                String   @id @default(cuid())
  cacheKey          String   @unique
  cacheType         String   // 'clinic_search', 'doctor_profiles', 'service_coverage', etc.
  cachedData        Json
  expiresAt         DateTime
  accessCount       Int      @default(0)
  lastAccessedAt    DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([cacheType, expiresAt])
  @@index([lastAccessedAt])
  @@map("integration_cache")
}

model IntegrationValidation {
  id                String   @id @default(cuid())
  validationType    String   // 'data_consistency', 'relationship_integrity', 'business_rules'
  system1           String
  system2           String
  entityType        String
  entityId          String
  validationRules   Json
  validationResult  Json
  isValid           Boolean
  issues            Json?    // Array of validation issues
  severity          ValidationSeverity @default(MEDIUM)
  resolvedAt        DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([validationType, isValid])
  @@index([system1, system2])
  @@index([severity, createdAt])
  @@map("integration_validations")
}

// ========================================
// INTEGRATION PERFORMANCE INDEXES
// Optimized for Cross-System Queries (Sub-Phase 8.10)
// ========================================

// Composite indexes for common integration queries
// These optimize the most frequent cross-system operations

// Clinic integration queries
// Optimizes: Find Healthier SG participating clinics with services
// Usage: IntegrationPanel, ClinicSearch with program filters
@@index([clinicId])
@@index([clinicParticipation.status, clinicParticipation.accreditationLevel])
@@index([clinicParticipation.participationType])
@@index([clinicParticipation.capacityLimit, clinicParticipation.currentEnrollment])
@@index([isHealthierSGCovered])

// Service integration queries
// Optimizes: Find services with Healthier SG coverage and eligibility
// Usage: ServiceSearch, ProgramClinicCard service listing
@@index([isHealthierSGCovered])
@@index([isAvailable, isHealthierSGCovered])
@@index([category, isHealthierSGCovered])
@@index([price])

// Doctor integration queries
// Optimizes: Find doctors with program certifications and badges
// Usage: DoctorSearch, HealthierSGDoctorBadge display
@@index([doctorId])
@@index([doctorParticipation.status, doctorParticipation.certificationLevel])
@@index([doctorParticipation.totalPatients, doctorParticipation.programSatisfaction])

// User integration queries
// Optimizes: User program enrollment and preference management
// Usage: UserProfile, HealthierSGStatus, UnifiedHealthDashboard
@@index([userId])
@@index([healthierSgEnrolled, healthierSgRegistrationDate])
@@index([programPreferences, notificationPreferences])
@@index([healthGoals, currentConditions])

// Search and filtering optimization
// Optimizes: Cross-system search with multiple filters
// Usage: ProgramClinicCard filtering, service eligibility checking
@@index([name])
@@index([name, address])
@@index([specialties])
@@index([category])
@@index([languages])
@@index([isActive])
@@index([isActive, isHealthierSGCovered])

// Location-based integration queries
// Optimizes: Geographic search with program participation
// Usage: Nearby clinics with Healthier SG filtering
@@index([latitude, longitude])
@@index([latitude, longitude, isHealthierSGCovered])

// Time-based optimization
// Optimizes: Recent activity and enrollment queries
// Usage: Dashboard data, program participation history
@@index([createdAt])
@@index([updatedAt])
@@index([enrollmentDate, status])
@@index([lastPatientVisit])

// Capacity and availability optimization
// Optimizes: Real-time capacity checking for appointments
// Usage: ProgramClinicCard booking integration
@@index([capacity])
@@index([currentBookings])
@@index([capacity, currentBookings])
@@index([capacity, currentBookings, isAvailable])

// Program participation optimization
// Optimizes: Multi-program participation queries
// Usage: Program recommendations, enrollment status
@@index([userId, status])
@@index([programId, status])
@@index([enrollmentDate, status])

// Health goals and tracking optimization
// Optimizes: Health goal progress tracking
// Usage: UnifiedHealthDashboard goal monitoring
@@index([userId, status])
@@index([targetDate, status])
@@index([goalType, priority])

// Audit and analytics optimization
// Optimizes: System performance monitoring
// Usage: Integration metrics, audit logs
@@index([action, createdAt])
@@index([dataSensitivity, riskLevel])
@@index([syncStatus, createdAt])
@@index([metricType, recordedAt])

// Search and analytics optimization
// Optimizes: Cross-system search log analysis
// Usage: Search analytics, user behavior tracking
@@index([searchQuery, createdAt])
@@index([sourceSystem, targetSystems])
@@index([sessionId, createdAt])
@@index([userId, createdAt])

// Integration relationship optimization
// Optimizes: Cross-system relationship queries
// Usage: Relationship mapping, system integration status
@@index([system1, system2])
@@index([relationshipType, isActive])
@@index([validFrom, validTo])

// Cache optimization
// Optimizes: Frequently accessed integration data
// Usage: Program badges, coverage info display
@@index([cacheType, expiresAt])
@@index([lastAccessedAt])
@@index([expiresAt, cacheType])

// Notification optimization
// Optimizes: Program-specific notification delivery
// Usage: ProgramNotificationCenter filtering
@@index([userId, programId])
@@index([type, priority])
@@index([createdAt, isRead])
@@index([scheduledFor, status])

// Appointment integration optimization
// Optimizes: Program appointment booking and management
// Usage: Integrated appointment booking with program benefits
@@index([patientId, appointmentDate])
@@index([clinicId, appointmentDate])
@@index([serviceId, isHealthierSGCovered])
@@index([status, appointmentDate])
@@index([isHealthierSGIntegrated, status])

// Integration validation optimization
// Optimizes: Data consistency checking across systems
// Usage: Integration monitoring, data quality assurance
@@index([validationType, isValid])
@@index([system1, system2])
@@index([severity, createdAt])
@@index([resolvedAt])

// Error handling and retry optimization
// Optimizes: Failed integration operation management
// Usage: Sync error recovery, operation retry logic
@@index([syncStatus, retryCount])
@@index([maxRetries, errorMessage])
@@index([lastSyncAt, syncStatus])

// Performance monitoring optimization
// Optimizes: System performance tracking
// Usage: Integration health monitoring, SLA reporting
@@index([metricType, recordedAt])
@@index([sourceSystem, targetSystem])
@@index([period, recordedAt])
@@index([entityType, entityId])

// Integration preferences optimization
// Optimizes: User preference queries and updates
// Usage: User settings management, integration configuration
@@index([userId, system])
@@index([integrationType, isEnabled])
@@index([priority, isEnabled])

// Search result optimization
// Optimizes: Cross-system search result ranking
// Usage: Unified search across clinic, doctor, service systems
@@index([searchQuery, resultsCount])
@@index([responseTime, createdAt])
@@index([sessionId, conversionMetrics])

// Integration Enums
enum IntegrationSyncType {
  INITIAL_SYNC
  INCREMENTAL_SYNC
  FULL_SYNC
  REAL_TIME_SYNC
  SCHEDULED_SYNC
  ON_DEMAND_SYNC
}

enum IntegrationSyncStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
  RETRYING
}

enum IntegrationMetricType {
  API_CALLS
  DATA_VOLUME
  RESPONSE_TIME
  ERROR_RATE
  SYNC_FREQUENCY
  USER_ACTIVITY
  PERFORMANCE_SCORE
  RELIABILITY_SCORE
  INTEGRATION_HEALTH
}

enum IntegrationType {
  CLINIC_PROGRAM
  DOCTOR_CERTIFICATION
  SERVICE_COVERAGE
  USER_ENROLLMENT
  APPOINTMENT_INTEGRATION
  NOTIFICATION_SYNC
  DATA_AGGREGATION
  SEARCH_INTEGRATION
}

enum IntegrationSyncFrequency {
  MANUAL
  HOURLY
  DAILY
  WEEKLY
  REAL_TIME
  ON_DEMAND
}

enum ValidationSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

// ========================================
// CONTACT & ENQUIRY MANAGEMENT SYSTEM
// Sub-Phase 9.1: Comprehensive Database Architecture
// ========================================

// Contact Form Categories - Defines different types of enquiries
model ContactCategory {
  id                String   @id @default(cuid())
  name              String   @unique // 'general', 'appointment', 'healthier_sg', 'urgent', 'technical_support'
  displayName       String
  description       String?  @db.Text
  
  // Category characteristics
  requiresAuth      Boolean  @default(false) // Requires user login
  requiresVerification Boolean @default(false) // Requires identity verification
  priority          ContactCategoryPriority @default(STANDARD)
  department        ContactDepartment
  
  // Form configuration
  formFields        Json     @default("[]") // Required form fields for this category
  validationRules   Json     @default("{}") // Category-specific validation
  autoResponse      Boolean  @default(true) // Send automatic confirmation
  responseTemplate  String?  // Template for auto-response
  
  // Routing and assignment
  defaultAssignee   String?  // Default agent/department ID
  routingRules      Json     @default("[]") // Automatic routing rules
  escalationRules   Json     @default("[]") // Escalation triggers
  
  // SLA and response times
  responseSLAHours  Int      @default(24) // Target response time in hours
  resolutionSLADays Int      @default(7)  // Target resolution time in days
  
  // Status and metadata
  isActive          Boolean  @default(true)
  sortOrder         Int      @default(0)
  icon              String?  // Icon for UI display
  color             String?  // Color theme for category
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relationships
  enquiries         Enquiry[]
  templates         ContactFormTemplate[]

  @@index([name])
  @@index([isActive])
  @@index([priority])
  @@map("contact_categories")
}

// Contact Form Templates - Reusable form configurations
model ContactFormTemplate {
  id                String   @id @default(cuid())
  categoryId        String
  name              String
  displayName       String
  
  // Form structure
  formConfig        Json     @default("{}") // Complete form configuration
  fieldDefinitions  Json     @default("[]") // Field definitions and validation
  conditionalLogic  Json     @default("{}") // Dynamic field visibility rules
  layout            Json     @default("{}") // UI layout configuration
  
  // Healthcare-specific features
  medicalFields     Boolean  @default(false) // Includes medical information fields
  requiresNric      Boolean  @default(false) // Requires Singapore NRIC
  requiresConsent   Boolean  @default(false) // Requires privacy consent
  hipaaCompliant    Boolean  @default(false) // Healthcare compliance required
  
  // Multilingual support
  translations      Json     @default("{}") // Translations for different languages
  supportedLanguages String[] @default(["en"]) // Supported language codes
  
  // Versioning
  version           String   @default("1.0")
  isActive          Boolean  @default(true)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  category          ContactCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([isActive])
  @@map("contact_form_templates")
}

// Main Contact Form Submission
model ContactForm {
  id                String   @id @default(cuid())
  
  // Form identification
  referenceNumber   String   @unique // Auto-generated reference
  categoryId        String
  templateId        String?
  
  // Form data
  subject           String
  message           String   @db.Text
  formData          Json     @default("{}") // All form field values
  
  // Contact information
  contactName       String
  contactEmail      String
  contactPhone      String?
  preferredContactMethod ContactMethod @default(EMAIL)
  
  // Healthcare-specific information
  userId            String?  // If submitted by registered user
  patientId         String?  // Patient ID if applicable
  clinicId          String?  // Related clinic
  doctorId          String?  // Related doctor
  serviceId         String?  // Related service
  
  // Medical information (if applicable)
  medicalInformation String? @db.Text
  urgencyLevel      UrgencyLevel @default(ROUTINE)
  appointmentUrgency AppointmentUrgency @default(STANDARD)
  
  // Submission details
  submissionSource  ContactSource @default(WEB_FORM)
  userAgent         String?
  ipAddress         String?
  referrerUrl       String?
  sessionId         String?
  
  // Consent and compliance
  privacyConsent    Boolean  @default(false)
  marketingConsent  Boolean  @default(false)
  dataRetentionConsent Boolean @default(false)
  consentVersion    String?  // Version of consent text
  gdprConsent       Boolean  @default(false)
  pdpaConsent       Boolean  @default(false)
  
  // Processing status
  status            ContactStatus @default(SUBMITTED)
  processingNotes   String?  @db.Text
  
  // Automated processing
  autoProcessed     Boolean  @default(false)
  spamCheckResult   SpamCheckResult @default(PENDING)
  duplicateCheck    Boolean  @default(false)
  duplicateOfId     String?  // ID of duplicate form if found
  
  // Response tracking
  responseRequired  Boolean  @default(true)
  autoResponseSent  Boolean  @default(false)
  responseDue       DateTime?
  responseSent      DateTime?
  firstResponseTime Int?     // Minutes to first response
  
  // Priority and routing
  priority          ContactPriority @default(NORMAL)
  assignedAgentId   String?
  assignedDepartment ContactDepartment @default(GENERAL)
  
  // Audit trail
  createdBy         String?  // User ID or 'anonymous'
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relationships
  category          ContactCategory @relation(fields: [categoryId], references: [id])
  template          ContactFormTemplate? @relation(fields: [templateId], references: [id], onDelete: SetNull)
  user              User? @relation(fields: [userId], references: [id], onDelete: SetNull)
  clinic            Clinic? @relation(fields: [clinicId], references: [id], onDelete: SetNull)
  doctor            Doctor? @relation(fields: [doctorId], references: [id], onDelete: SetNull)
  service           Service? @relation(fields: [serviceId], references: [id], onDelete: SetNull)
  
  // Related entities
  enquiry           Enquiry?
  assignments       ContactAssignment[]
  histories         ContactHistory[]
  responses         ContactResponse[]
  analytics         ContactFormAnalytics?

  @@index([referenceNumber])
  @@index([categoryId])
  @@index([status])
  @@index([priority])
  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
  @@index([serviceId])
  @@index([createdAt])
  @@index([responseDue])
  @@index([contactEmail])
  @@index([contactPhone])
  @@map("contact_forms")
}

// Detailed Enquiry Management
model Enquiry {
  id                String   @id @default(cuid())
  contactFormId     String?  @unique
  
  // Enquiry identification
  enquiryNumber     String   @unique // Auto-generated enquiry number
  title             String
  
  // Category and type
  categoryId        String
  enquiryType       EnquiryType
  
  // Status tracking
  status            EnquiryStatus @default(NEW)
  subStatus         String?       // Detailed status (waiting_for_customer, etc.)
  resolutionStatus  ResolutionStatus @default(OPEN)
  
  // Priority and urgency
  priority          EnquiryPriority @default(NORMAL)
  urgencyLevel      UrgencyLevel @default(ROUTINE)
  businessImpact    BusinessImpact @default(LOW)
  
  // Assignment and routing
  assignedAgentId   String?
  assignedTeam      ContactTeam?
  supervisorId      String?
  originalAssignee  String?      // Who was originally assigned
  
  // Healthcare-specific routing
  department        ContactDepartment @default(GENERAL)
  specializedTeam   String?      // e.g., 'healthier_sg_specialists'
  medicalReview     Boolean      @default(false) // Requires medical review
  complianceReview  Boolean      @default(false) // Requires compliance review
  
  // Related entities
  userId            String?      // Customer user ID
  patientId         String?      // Patient ID if applicable
  clinicId          String?      // Related clinic
  doctorId          String?      // Related doctor
  serviceId         String?      // Related service
  appointmentId     String?      // Related appointment
  
  // Enquiry content
  description       String       @db.Text
  initialInquiry    String       @db.Text
  customerExpectations String?  @db.Text
  requiredAction    String?      @db.Text
  
  // Resolution tracking
  resolutionSummary String?      @db.Text
  resolutionNotes   String?      @db.Text
  closureReason     String?      @db.Text
  customerSatisfaction Int?      // 1-5 rating
  
  // SLA tracking
  slaBreached       Boolean      @default(false)
  slaBreachReason   String?      @db.Text
  escalationCount   Int          @default(0)
  lastEscalationAt  DateTime?
  
  // Follow-up requirements
  requiresFollowUp  Boolean      @default(false)
  followUpRequired  Boolean      @default(false)
  followUpDate      DateTime?
  followUpNotes     String?      @db.Text
  followUpCompleted Boolean      @default(false)
  
  // Integration tracking
  externalReference String?      // External system reference
  integrationStatus IntegrationSyncStatus @default(PENDING)
  syncData          Json         @default("{}")
  
  // Workflow tracking
  workflowStage     String       @default("intake") // intake, investigation, resolution, closure
  workflowData      Json         @default("{}")
  
  // Metadata
  sourceChannel     ContactSource @default(WEB_FORM)
  tags              String[]      @default([])
  customFields      Json          @default("{}")
  
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  assignedAt        DateTime?
  resolvedAt        DateTime?
  closedAt          DateTime?

  // Relationships
  contactForm       ContactForm @relation(fields: [contactFormId], references: [id], onDelete: Cascade)
  category          ContactCategory @relation(fields: [categoryId], references: [id])
  user              User? @relation(fields: [userId], references: [id], onDelete: SetNull)
  clinic            Clinic? @relation(fields: [clinicId], references: [id], onDelete: SetNull)
  doctor            Doctor? @relation(fields: [doctorId], references: [id], onDelete: SetNull)
  service           Service? @relation(fields: [serviceId], references: [id], onDelete: SetNull)
  
  // Related entities
  assignments       ContactAssignment[]
  histories         ContactHistory[]
  responses         ContactResponse[]
  analytics         ContactEnquiryAnalytics?
  escalations       ContactEscalation[]

  @@index([enquiryNumber])
  @@index([categoryId])
  @@index([status])
  @@index([priority])
  @@index([assignedAgentId])
  @@index([assignedTeam])
  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
  @@index([serviceId])
  @@index([createdAt])
  @@index([resolvedAt])
  @@index([followUpDate])
  @@index([slaBreached])
  @@index([urgencyLevel])
  @@map("enquiries")
}

// Contact Assignment Management
model ContactAssignment {
  id                String   @id @default(cuid())
  enquiryId         String
  contactFormId     String?
  
  // Assignment details
  assigneeType      AssigneeType // AGENT, TEAM, DEPARTMENT
  assigneeId        String?      // Agent/team/department ID
  assigneeName      String       // Denormalized for performance
  
  // Assignment context
  assignmentReason  String?      @db.Text
  assignedBy        String       // User ID who made assignment
  assignmentMethod  AssignmentMethod // MANUAL, AUTO_ROUND_ROBIN, AUTO_SKILL_BASED
  skillMatch        Json         @default("{}") // Skills matching data
  
  // Assignment status
  status            AssignmentStatus @default(ACTIVE)
  acceptedAt        DateTime?
  declinedAt        DateTime?
  declineReason     String?      @db.Text
  
  // Reassignment tracking
  isReassignment    Boolean      @default(false)
  previousAssignee  String?
  reassignmentReason String?     @db.Text
  
  // Workload management
  currentWorkload   Int          @default(0) // Current number of active enquiries
  workloadLimit     Int?         // Maximum workload for this assignee
  
  // Performance tracking
  assignmentScore   Float?       // How well this assignment matches requirements
  responseTime      Int?         // Minutes to first response
  resolutionTime    Int?         // Minutes to resolution
  
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  enquiry           Enquiry @relation(fields: [enquiryId], references: [id], onDelete: Cascade)
  contactForm       ContactForm? @relation(fields: [contactFormId], references: [id], onDelete: Cascade)

  @@index([enquiryId])
  @@index([contactFormId])
  @@index([assigneeType, assigneeId])
  @@index([status])
  @@index([assignedBy])
  @@index([createdAt])
  @@map("contact_assignments")
}

// Contact History and Communication Trail
model ContactHistory {
  id                String   @id @default(cuid())
  enquiryId         String
  contactFormId     String?
  
  // History entry details
  actionType        ContactActionType
  actionDescription String   @db.Text
  
  // Actor information
  actorType         ActorType // USER, AGENT, SYSTEM, AUTOMATION
  actorId           String?   // ID of who performed the action
  actorName         String    // Name for display
  actorEmail        String?
  
  // Change tracking
  fieldChanged      String?   // Field that was changed
  oldValue          String?   @db.Text
  newValue          String?   @db.Text
  changeReason      String?   @db.Text
  
  // Communication details
  communicationType CommunicationType
  messageContent    String?   @db.Text
  messageSubject    String?
  messageDirection  MessageDirection @default(OUTBOUND)
  
  // External communication
  externalSystem    String?   // External system involved
  externalReference String?   // Reference in external system
  deliveryStatus    DeliveryStatus?
  
  // Time tracking
  timeSpent         Int?      // Minutes spent on this action
  responseTime      Int?      // Minutes to respond
  
  // Healthcare compliance
  medicalRecord     Boolean   @default(false)
  containsPHI       Boolean   @default(false) // Protected Health Information
  hipaaCompliant    Boolean   @default(false)
  auditTrail        Boolean   @default(true)
  
  // Metadata
  metadata          Json      @default("{}")
  tags              String[]  @default([])
  
  createdAt         DateTime  @default(now())

  enquiry           Enquiry @relation(fields: [enquiryId], references: [id], onDelete: Cascade)
  contactForm       ContactForm? @relation(fields: [contactFormId], references: [id], onDelete: Cascade)

  @@index([enquiryId])
  @@index([contactFormId])
  @@index([actionType])
  @@index([actorType, actorId])
  @@index([createdAt])
  @@index([communicationType])
  @@map("contact_histories")
}

// Contact Responses and Communication
model ContactResponse {
  id                String   @id @default(cuid())
  enquiryId         String
  contactFormId     String?
  
  // Response details
  responseType      ResponseType
  subject           String?
  content           String    @db.Text
  
  // Sender information
  senderType        SenderType
  senderId          String?   // ID of sender
  senderName        String
  senderEmail       String?
  senderSignature   String?   // Email signature
  
  // Recipient information
  recipientType     RecipientType
  recipientId       String?   // ID of recipient
  recipientName     String
  recipientEmail    String
  
  // Communication channel
  channel           CommunicationChannel
  channelReference  String?   // Message ID, ticket ID, etc.
  
  // Response status
  status            ResponseStatus @default(DRAFT)
  sentAt            DateTime?
  deliveredAt       DateTime?
  readAt            DateTime?
  repliedAt         DateTime?
  
  // Quality tracking
  satisfactionRating Int?     // 1-5 rating from recipient
  qualityScore      Float?    // Internal quality assessment
  responseTime      Int?      // Minutes from enquiry to response
  
  // Template and automation
  templateUsed      String?   // Template used for response
  autoGenerated     Boolean   @default(false)
  automationRules   Json      @default("[]")
  
  // Healthcare compliance
  medicalAdvice     Boolean   @default(false)
  disclaimerRequired Boolean  @default(false)
  complianceChecked Boolean   @default(false)
  privacyReviewed   Boolean   @default(false)
  
  // Attachments and files
  attachments       Json      @default("[]") // Array of attachment info
  attachmentCount   Int       @default(0)
  
  // Follow-up actions
  requiresFollowUp  Boolean   @default(false)
  followUpDate      DateTime?
  followUpNotes     String?   @db.Text
  followUpCompleted Boolean   @default(false)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  enquiry           Enquiry @relation(fields: [enquiryId], references: [id], onDelete: Cascade)
  contactForm       ContactForm? @relation(fields: [contactFormId], references: [id], onDelete: Cascade)

  @@index([enquiryId])
  @@index([contactFormId])
  @@index([responseType])
  @@index([senderType, senderId])
  @@index([channel])
  @@index([status])
  @@index([sentAt])
  @@index([recipientEmail])
  @@map("contact_responses")
}

// Contact Routing and Assignment Rules
model ContactRouting {
  id                String   @id @default(cuid())
  name              String   @unique
  displayName       String
  description       String?  @db.Text
  
  // Routing configuration
  isActive          Boolean  @default(true)
  priority          Int      @default(0) // Lower number = higher priority
  categoryId        String?  // Specific category, null for all
  
  // Routing criteria
  criteria          Json     @default("{}") // Conditions for routing
  weight            Float    @default(1.0)  // Rule weight
  
  // Routing targets
  targetType        RoutingTargetType
  targetId          String?  // Agent, team, or department ID
  targetName        String
  
  // Routing methods
  routingMethod     RoutingMethod @default(DIRECT)
  roundRobinGroup   String?       // For round-robin routing
  skillRequirements Json          @default("[]") // Required skills
  
  // Availability checks
  checkAvailability Boolean  @default(true)
  maxWorkload       Int?     // Maximum concurrent enquiries
  businessHoursOnly Boolean  @default(false)
  timezone          String?  // Target timezone
  
  // Fallback configuration
  fallbackEnabled   Boolean  @default(false)
  fallbackTarget    String?  // Fallback routing target
  fallbackDelay     Int?     // Minutes before fallback triggers
  
  // Performance tracking
  usageCount        Int      @default(0)
  successRate       Float?   // Success rate of this routing rule
  avgResponseTime   Int?     // Average response time in minutes
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([isActive])
  @@index([priority])
  @@index([categoryId])
  @@index([targetType, targetId])
  @@map("contact_routing")
}

// Contact Escalation Management
model ContactEscalation {
  id                String   @id @default(cuid())
  enquiryId         String
  
  // Escalation details
  escalationType    EscalationType
  escalationReason  String   @db.Text
  triggeredBy       String   @db.Text // Reason for escalation
  
  // Escalation levels
  fromLevel         EscalationLevel
  toLevel           EscalationLevel
  levelData         Json     @default("{}")
  
  // Timing
  triggeredAt       DateTime @default(now())
  processedAt       DateTime?
  resolvedAt        DateTime?
  
  // Actors
  triggeredByUser   String?  // User who triggered escalation
  escalatedToUser   String?  // User who received escalation
  escalatedToTeam   String?  // Team that received escalation
  
  // Status and resolution
  status            EscalationStatus @default(ACTIVE)
  resolutionNotes   String?  @db.Text
  customerNotified  Boolean  @default(false)
  
  // Impact tracking
  slaImpact         Json     @default("{}") // SLA impact data
  resolutionTime    Int?     // Minutes to resolve escalation
  
  // Automation
  autoTriggered     Boolean  @default(false)
  automationRule    String?  // Rule that triggered escalation
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  enquiry           Enquiry @relation(fields: [enquiryId], references: [id], onDelete: Cascade)

  @@index([enquiryId])
  @@index([status])
  @@index([triggeredAt])
  @@index([escalatedToUser])
  @@map("contact_escalations")
}

// Contact Analytics and Performance Tracking
model ContactFormAnalytics {
  id                String   @id @default(cuid())
  contactFormId     String   @unique
  
  // Submission metrics
  submissionTime    Int      @default(0) // Seconds to complete form
  fieldCompletionTime Json   @default("{}") // Time per field
  abandonRate       Float?   // Form abandonment rate
  completionRate    Float?   // Form completion rate
  
  // User experience metrics
  userSatisfaction  Float?   // 1-5 rating from user
  errorCount        Int      @default(0)
  correctionCount   Int      @default(0) // How many times user corrected data
  
  // Channel performance
  deviceType        DeviceType?
  browserType       String?
  referralSource    String?
  conversionFunnel  Json     @default("{}")
  
  // Content analysis
  messageSentiment  SentimentScore @default(NEUTRAL)
  urgencyDetected   Boolean  @default(false)
  spamScore         Float?   // Spam detection score
  
  // Integration metrics
  apiResponseTime   Int?     // Milliseconds
  databaseQueryTime Int?     // Milliseconds
  processingTime    Int?     // Total processing time
  
  // A/B testing
  testVariant       String?  // A/B test variant
  testResults       Json     @default("{}")
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  contactForm       ContactForm @relation(fields: [contactFormId], references: [id], onDelete: Cascade)

  @@index([contactFormId])
  @@map("contact_form_analytics")
}

model ContactEnquiryAnalytics {
  id                String   @id @default(cuid())
  enquiryId         String   @unique
  
  // Resolution metrics
  totalResolutionTime Int?   // Total minutes to resolution
  firstResponseTime  Int?     // Minutes to first response
  followUpCount      Int      @default(0) // Number of follow-ups needed
  communicationCount Int      @default(0) // Total communications
  
  // Quality metrics
  customerSatisfaction Float? // 1-5 rating
  agentSatisfaction   Float?  // Agent self-rating
  qualityScore        Float?  // Internal quality assessment
  
  // Efficiency metrics
  resolutionEfficiency Float? // Score based on time vs complexity
  knowledgeBaseUsage   Float? // How much KB was used
  escalationRate       Float? // Whether escalation was needed
  
  // Cost metrics
  handlingCost        Float?  // Estimated cost to handle
  agentTimeCost       Float?  // Agent time cost
  systemResourceCost  Float?  // System resource cost
  
  // Outcome tracking
  resolved           Boolean  @default(false)
  customerRetained   Boolean? // Whether customer was retained
  repeatContact      Boolean  @default(false) // Customer contacted again
  
  // Learning and improvement
  lessonsLearned     String?  @db.Text
  improvementSuggestions String? @db.Text
  processImprovements Json     @default("[]")
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  enquiry           Enquiry @relation(fields: [enquiryId], references: [id], onDelete: Cascade)

  @@index([enquiryId])
  @@map("contact_enquiry_analytics")
}

// Contact Templates and Auto-Responses
model ContactTemplate {
  id                String   @id @default(cuid())
  name              String   @unique
  displayName       String
  description       String?  @db.Text
  
  // Template configuration
  category          ContactTemplateCategory
  usage             TemplateUsage
  language          String   @default("en")
  
  // Content
  subject           String?
  content           String   @db.Text
  variables         Json     @default("[]") // Available template variables
  
  // Healthcare compliance
  medicalAdvice     Boolean  @default(false)
  disclaimerRequired Boolean  @default(false)
  complianceNote    String?  @db.Text
  
  // Personalization
  personalizationEnabled Boolean @default(true)
  dynamicContent    Boolean  @default(false)
  
  // Versioning
  version           String   @default("1.0")
  isActive          Boolean  @default(true)
  
  // Usage tracking
  usageCount        Int      @default(0)
  lastUsedAt        DateTime?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([category])
  @@index([isActive])
  @@index([usageCount])
  @@map("contact_templates")
}

// Contact Knowledge Base Integration
model ContactKnowledgeBase {
  id                String   @id @default(cuid())
  title             String
  content           String   @db.Text
  
  // Categorization
  category          String
  tags              String[] @default([])
  relatedTopics     String[] @default([])
  
  // Healthcare specific
  medicalSpecialty  String?  // Related medical specialty
  applicableConditions String[] @default([])
  ageGroup          String?  // Target age group
  
  // Usage tracking
  viewCount         Int      @default(0)
  helpfulCount      Int      @default(0)
  unhelpfulCount    Int      @default(0)
  
  // Search optimization
  keywords          String[] @default([])
  searchTerms       String[] @default([])
  
  // Quality and status
  status            KBStatus @default(ACTIVE)
  verifiedBy        String?  // Medical professional verification
  verifiedAt        DateTime?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([category])
  @@index([status])
  @@index([medicalSpecialty])
  @@map("contact_knowledge_base")
}

// ========================================
// CONTACT SYSTEM ENUMS
// ========================================

// Contact Categories
enum ContactCategoryPriority {
  LOW
  STANDARD
  HIGH
  URGENT
  CRITICAL
}

// Contact Departments
enum ContactDepartment {
  GENERAL
  APPOINTMENTS
  HEALTHIER_SG
  TECHNICAL_SUPPORT
  MEDICAL_INQUIRIES
  BILLING
  COMPLIANCE
  QUALITY_ASSURANCE
  EMERGENCY
}

// Contact Status
enum ContactStatus {
  SUBMITTED
  UNDER_REVIEW
  ASSIGNED
  IN_PROGRESS
  WAITING_CUSTOMER
  PENDING_RESOLUTION
  RESOLVED
  CLOSED
  CANCELLED
  ESCALATED
}

// Contact Priority
enum ContactPriority {
  LOW
  NORMAL
  HIGH
  URGENT
  CRITICAL
  EMERGENCY
}

// Contact Source
enum ContactSource {
  WEB_FORM
  EMAIL
  PHONE
  CHAT
  MOBILE_APP
  SOCIAL_MEDIA
  WALK_IN
  REFERRAL
  API
  SMS
}

// Contact Method
enum ContactMethod {
  EMAIL
  PHONE
  SMS
  CHAT
  MAIL
  IN_PERSON
}

// Spam Check Result
enum SpamCheckResult {
  PENDING
  CLEAN
  SUSPICIOUS
  SPAM
  MALICIOUS
}

// Enquiry Status
enum EnquiryStatus {
  NEW
  UNDER_REVIEW
  ASSIGNED
  IN_PROGRESS
  WAITING_CUSTOMER
  WAITING_INTERNAL
  PENDING_RESOLUTION
  RESOLVED
  CLOSED
  CANCELLED
  ESCALATED
}

// Enquiry Type
enum EnquiryType {
  INFORMATIONAL
  COMPLAINT
  COMPLIMENT
  SUGGESTION
  SUPPORT_REQUEST
  TECHNICAL_ISSUE
  BILLING_INQUIRY
  APPOINTMENT_RELATED
  MEDICAL_INQUIRY
  COMPLIANCE_ISSUE
}

// Enquiry Priority
enum EnquiryPriority {
  LOW
  NORMAL
  HIGH
  URGENT
  CRITICAL
  EMERGENCY
}

// Resolution Status
enum ResolutionStatus {
  OPEN
  IN_PROGRESS
  PENDING_CUSTOMER
  PENDING_INTERNAL
  RESOLVED
  CLOSED
  CANCELLED
}

// Business Impact
enum BusinessImpact {
  LOW
  MEDIUM
  HIGH
  CRITICAL
  REPUTATIONAL
  LEGAL
  FINANCIAL
}

// Contact Team
enum ContactTeam {
  GENERAL_SUPPORT
  APPOINTMENT_TEAM
  HEALTHIER_SG_SPECIALISTS
  TECHNICAL_SUPPORT
  MEDICAL_CONSULTANTS
  BILLING_SUPPORT
  COMPLIANCE_TEAM
  ESCALATION_TEAM
  EMERGENCY_RESPONSE
}

// Appointment Urgency
enum AppointmentUrgency {
  STANDARD
  PRIORITY
  URGENT
  EMERGENCY
  WALK_IN
  SAME_DAY
}

// Assignee Type
enum AssigneeType {
  AGENT
  TEAM
  DEPARTMENT
  SPECIALIST
  SUPERVISOR
}

// Assignment Method
enum AssignmentMethod {
  MANUAL
  AUTO_ROUND_ROBIN
  AUTO_SKILL_BASED
  AUTO_LOAD_BALANCED
  AUTO_SPECIALIST
  AUTO_ESCALATION
}

// Assignment Status
enum AssignmentStatus {
  ACTIVE
  ACCEPTED
  DECLINED
  COMPLETED
  TRANSFERRED
  ESCALATED
}

// Contact Action Type
enum ContactActionType {
  CREATED
  ASSIGNED
  STATUS_CHANGED
  RESPONDED
  ESCALATED
  RESOLVED
  CLOSED
  REOPENED
  MERGED
  SPLIT
  UPDATED
  NOTE_ADDED
  FILE_ATTACHED
  TEMPLATE_APPLIED
  AUTOMATION_TRIGGERED
}

// Actor Type
enum ActorType {
  USER
  AGENT
  SUPERVISOR
  SYSTEM
  AUTOMATION
  ADMIN
  API
  INTEGRATION
}

// Communication Type
enum CommunicationType {
  EMAIL
  PHONE_CALL
  SMS
  CHAT_MESSAGE
  LETTER
  IN_PERSON
  SYSTEM_NOTIFICATION
  AUTOMATED_RESPONSE
  TICKET_UPDATE
  STATUS_CHANGE
}

// Message Direction
enum MessageDirection {
  INBOUND
  OUTBOUND
  INTERNAL
}

// Delivery Status
enum DeliveryStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED
  BOUNCED
  REPLIED
}

// Response Type
enum ResponseType {
  INITIAL_RESPONSE
  FOLLOW_UP
  RESOLUTION
  CLOSURE
  ESCALATION_NOTE
  INTERNAL_NOTE
  CUSTOMER_UPDATE
  SYSTEM_AUTOMATION
  TEMPLATE_RESPONSE
}

// Sender Type
enum SenderType {
  AGENT
  SUPERVISOR
  SYSTEM
  AUTOMATION
  TEMPLATE
  SPECIALIST
}

// Recipient Type
enum RecipientType {
  CUSTOMER
  AGENT
  SUPERVISOR
  DEPARTMENT
  TEAM
  SPECIALIST
  SYSTEM
}

// Communication Channel
enum CommunicationChannel {
  EMAIL
  SMS
  PHONE
  CHAT
  TICKET_SYSTEM
  PORTAL
  MAIL
  IN_PERSON
  SYSTEM
  API
}

// Response Status
enum ResponseStatus {
  DRAFT
  PENDING
  SENT
  DELIVERED
  READ
  REPLIED
  FAILED
  CANCELLED
}

// Device Type
enum DeviceType {
  DESKTOP
  MOBILE
  TABLET
  UNKNOWN
}

// Sentiment Score
enum SentimentScore {
  VERY_NEGATIVE
  NEGATIVE
  NEUTRAL
  POSITIVE
  VERY_POSITIVE
  MIXED
}

// Routing Target Type
enum RoutingTargetType {
  AGENT
  TEAM
  DEPARTMENT
  SPECIALIST
  QUEUE
  POOL
}

// Routing Method
enum RoutingMethod {
  DIRECT
  ROUND_ROBIN
  SKILL_BASED
  LOAD_BALANCED
  PRIORITY_BASED
  SPECIALIST
  GEOGRAPHIC
  LANGUAGE_BASED
  AVAILABILITY
}

// Escalation Type
enum EscalationType {
  SLA_BREACH
  CUSTOMER_REQUEST
  COMPLEXITY
  SUPERVISOR_REQUEST
  SPECIALIST_REQUIRED
  COMPLIANCE_ISSUE
  EMERGENCY
  TECHNICAL
  COMPLAINT
  QUALITY_ISSUE
}

// Escalation Level
enum EscalationLevel {
  L1_AGENT
  L2_SUPERVISOR
  L3_SPECIALIST
  L4_MANAGER
  L5_DIRECTOR
  L6_EXECUTIVE
  EMERGENCY
  COMPLIANCE
  TECHNICAL
  MEDICAL
}

// Escalation Status
enum EscalationStatus {
  ACTIVE
  IN_PROGRESS
  RESOLVED
  CANCELLED
  ESCALATED_FURTHER
}

// Contact Template Category
enum ContactTemplateCategory {
  AUTO_RESPONSE
  ACKNOWLEDGMENT
  RESOLUTION
  ESCALATION
  CLOSURE
  FOLLOW_UP
  ERROR_MESSAGE
  INFORMATION_REQUEST
  COMPLAINT_RESPONSE
  COMPLIMENT_ACKNOWLEDGMENT
}

// Template Usage
enum TemplateUsage {
  AUTOMATIC
  MANUAL
  TRIGGERED
  SCHEDULED
  CONDITIONAL
  ON_DEMAND
}

// Knowledge Base Status
enum KBStatus {
  DRAFT
  UNDER_REVIEW
  ACTIVE
  ARCHIVED
  DEPRECATED
  UNDER_REVISION
  VERIFIED
}